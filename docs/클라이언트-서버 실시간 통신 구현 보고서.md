# ğŸ”Œ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-10-23
**í”„ë¡œì íŠ¸**: ListenUp! - ì‹¤ì‹œê°„ ìŒì•… ë§ì¶”ê¸° ê²Œì„
**ì‘ì—… ë²”ìœ„**: Socket.IO ê¸°ë°˜ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸ êµ¬í˜„

---

## ğŸ“‹ ëª©ì°¨

1. [ì‘ì—… ê°œìš”](#ì‘ì—…-ê°œìš”)
2. [êµ¬í˜„ ë‚´ìš©](#êµ¬í˜„-ë‚´ìš©)
3. [ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­](#ê¸°ìˆ ì -ì„¸ë¶€ì‚¬í•­)
4. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
5. [í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](#í…ŒìŠ¤íŠ¸-ê°€ì´ë“œ)
6. [ì½”ë“œ êµ¬ì¡°](#ì½”ë“œ-êµ¬ì¡°)
7. [í–¥í›„ ê°œì„  ì‚¬í•­](#í–¥í›„-ê°œì„ -ì‚¬í•­)

---

## ì‘ì—… ê°œìš”

### ëª©í‘œ
Socket.IOë¥¼ í™œìš©í•œ í´ë¼ì´ì–¸íŠ¸-ì„œë²„ ê°„ ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ ì„ êµ¬í˜„í•˜ê³ , ë°© ìƒì„±/ì°¸ê°€/í‡´ì¥ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” UIë¥¼ ì œì‘í•©ë‹ˆë‹¤.

### ì™„ë£Œëœ ì‘ì—…
1. âœ… Socket.IO í´ë¼ì´ì–¸íŠ¸ ì—°ê²° êµ¬í˜„
2. âœ… ì‹¤ì‹œê°„ ë°© ê´€ë¦¬ UI ì œì‘
3. âœ… ì´ë²¤íŠ¸ ê¸°ë°˜ ìƒíƒœ ë™ê¸°í™”
4. âœ… TypeScript íƒ€ì… ì •ì˜ ì¶”ê°€
5. âœ… Vite í”„ë¡ì‹œ ì„¤ì • ë° ì—°ê²° ì˜¤ë¥˜ í•´ê²°
6. âœ… í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„±

### ì£¼ìš” ê¸°ëŠ¥
- Socket.IO ìë™ ì—°ê²° ë° ì¬ì—°ê²°
- ì‹¤ì‹œê°„ ì—°ê²° ìƒíƒœ í‘œì‹œ
- ë°© ìƒì„± (ë‹‰ë„¤ì„ + ì„¤ì •)
- ë°© ì°¸ê°€ (ë°© ì½”ë“œ ì…ë ¥)
- ë°© ë‚˜ê°€ê¸°
- ì‹¤ì‹œê°„ í”Œë ˆì´ì–´ ëª©ë¡ ë™ê¸°í™”
- ë°©ì¥ ìë™ ìœ„ì„ ì•Œë¦¼
- ì—ëŸ¬ í•¸ë“¤ë§ ë° ì‚¬ìš©ì í”¼ë“œë°±

---

## êµ¬í˜„ ë‚´ìš©

### 1. íŒŒì¼ êµ¬ì¡°

```
packages/client/src/
â”œâ”€â”€ App.svelte              # ë©”ì¸ í…ŒìŠ¤íŠ¸ UI (ìƒˆë¡œ ì‘ì„±)
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ socket.ts           # Socket.IO í´ë¼ì´ì–¸íŠ¸ (ìˆ˜ì •)
â”œâ”€â”€ vite-env.d.ts           # Vite í™˜ê²½ë³€ìˆ˜ íƒ€ì… ì •ì˜ (ì‹ ê·œ)
â””â”€â”€ main.ts

packages/client/
â”œâ”€â”€ vite.config.ts          # Vite ì„¤ì • (í”„ë¡ì‹œ í™•ì¸)
â”œâ”€â”€ tsconfig.json           # TypeScript ì„¤ì • (ìˆ˜ì •)
â””â”€â”€ package.json

docs/
â””â”€â”€ CLIENT_SERVER_COMMUNICATION_REPORT.md  # ì´ ë¬¸ì„œ

TEST_GUIDE.md               # í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ì´ë“œ
```

### 2. êµ¬í˜„ëœ í™”ë©´

#### 2.1 ì´ˆê¸° í™”ë©´ (ë¯¸ì—°ê²° ìƒíƒœ)
```
ğŸµ ListenUp! í…ŒìŠ¤íŠ¸

[ë¹¨ê°„ìƒ‰ ì¸ë””ì¼€ì´í„°] ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•ŠìŒ

ë‹‰ë„¤ì„: [        ]
        (ë¹„í™œì„±í™”)

ğŸ  ìƒˆ ë°© ë§Œë“¤ê¸°
   (ë¹„í™œì„±í™”)

ë˜ëŠ”

ë°© ì½”ë“œ: [      ]
         (ë¹„í™œì„±í™”)
ğŸšª ë°© ì°¸ê°€í•˜ê¸°
   (ë¹„í™œì„±í™”)
```

#### 2.2 ì—°ê²° ì„±ê³µ ìƒíƒœ
```
[ì´ˆë¡ìƒ‰ ì¸ë””ì¼€ì´í„°] âœ… ì„œë²„ ì—°ê²° ì„±ê³µ! (ID: xyz123)

ë‹‰ë„¤ì„: [í”Œë ˆì´ì–´1]
        (í™œì„±í™”)

ğŸ  ìƒˆ ë°© ë§Œë“¤ê¸°
   (í™œì„±í™”)

ë˜ëŠ”

ë°© ì½”ë“œ: [ABC123]
ğŸšª ë°© ì°¸ê°€í•˜ê¸°
   (í™œì„±í™”)
```

#### 2.3 ë°© ìƒì„±/ì°¸ê°€ í›„
```
ğŸ  ë°© ì •ë³´

ë°© ì½”ë“œ: ABC123
ë°©ì¥: í”Œë ˆì´ì–´1
í”Œë ˆì´ì–´: 2 / 8ëª…
ë¼ìš´ë“œ ì‹œê°„: 30ì´ˆ

ğŸ‘¥ ì°¸ê°€ì ëª©ë¡

[ğŸ˜€] í”Œë ˆì´ì–´1 ğŸ‘‘
[ğŸ˜] í”Œë ˆì´ì–´2

ğŸšª ë°© ë‚˜ê°€ê¸°
```

### 3. Socket.IO ì´ë²¤íŠ¸ íë¦„

#### 3.1 ì—°ê²° ë‹¨ê³„
```
í´ë¼ì´ì–¸íŠ¸ ì‹œì‘
    â†“
socket.connect()
    â†“
[ì´ë²¤íŠ¸] "connect"
    â†“
ìƒíƒœ: connected = true
    â†“
UI í™œì„±í™”
```

#### 3.2 ë°© ìƒì„± íë¦„
```
ì‚¬ìš©ì: ë‹‰ë„¤ì„ ì…ë ¥ + ë²„íŠ¼ í´ë¦­
    â†“
emit("create-room", { nickname, settings })
    â†“
ì„œë²„: RoomService.createRoom()
    â†“
callback({ success: true, room })
    â†“
í´ë¼ì´ì–¸íŠ¸: currentRoom ì—…ë°ì´íŠ¸
    â†“
UI: ë°© ì •ë³´ í™”ë©´ í‘œì‹œ
```

#### 3.3 ë°© ì°¸ê°€ íë¦„
```
ì‚¬ìš©ì: ë‹‰ë„¤ì„ + ë°© ì½”ë“œ ì…ë ¥
    â†“
emit("join-room", { code, nickname })
    â†“
ì„œë²„: RoomService.joinRoom()
    â†“
callback({ success: true, room })  â†’ ìš”ì²­ì
emit("player-joined", { player })  â†’ ê¸°ì¡´ í”Œë ˆì´ì–´ë“¤
    â†“
ëª¨ë“  í´ë¼ì´ì–¸íŠ¸: í”Œë ˆì´ì–´ ëª©ë¡ ì—…ë°ì´íŠ¸
```

#### 3.4 ì‹¤ì‹œê°„ ë™ê¸°í™”
```
í”Œë ˆì´ì–´ A: ë°© ë‚˜ê°€ê¸°
    â†“
emit("leave-room", { code })
    â†“
ì„œë²„: RoomService.leaveRoom()
    â†“
emit("player-left", { playerId, newHostId })
    â†“
í”Œë ˆì´ì–´ B, C: ëª©ë¡ ì—…ë°ì´íŠ¸ + ë°©ì¥ ë³€ê²½ í‘œì‹œ
```

---

## ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### 1. Socket.IO í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

#### íŒŒì¼: `packages/client/src/lib/socket.ts`

```typescript
import { io, Socket } from "socket.io-client";

let socket: Socket | null = null;

export function initSocket(): Socket {
  if (!socket) {
    // ê°œë°œ í™˜ê²½: Vite í”„ë¡ì‹œ ì‚¬ìš© (ë¹ˆ ë¬¸ìì—´)
    // í”„ë¡œë•ì…˜: í™˜ê²½ë³€ìˆ˜ë¡œ ì„œë²„ URL ì§€ì •
    const serverUrl = import.meta.env.VITE_SERVER_URL || "";

    socket = io(serverUrl, {
      autoConnect: false,
      path: "/socket.io",
    });
  }

  return socket;
}
```

**ì„¤ê³„ ê·¼ê±°:**
- **ì‹±ê¸€í†¤ íŒ¨í„´**: ì•± ì „ì²´ì—ì„œ í•˜ë‚˜ì˜ ì†Œì¼“ ì¸ìŠ¤í„´ìŠ¤ë§Œ ì‚¬ìš©
- **autoConnect: false**: ëª…ì‹œì  ì—°ê²° ì œì–´ (onMountì—ì„œ connect í˜¸ì¶œ)
- **ë¹ˆ ë¬¸ìì—´**: ê°œë°œ í™˜ê²½ì—ì„œ Vite í”„ë¡ì‹œ ì‚¬ìš© (CORS íšŒí”¼)
- **í™˜ê²½ë³€ìˆ˜ ì§€ì›**: í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ìœ ì—°ì„± í™•ë³´

### 2. Vite í”„ë¡ì‹œ ì„¤ì •

#### íŒŒì¼: `packages/client/vite.config.ts`

```typescript
export default defineConfig({
  plugins: [svelte()],
  server: {
    port: 5173,
    proxy: {
      "/socket.io": {
        target: "http://localhost:3000",
        ws: true,  // WebSocket í”„ë¡ì‹œ
      },
    },
  },
});
```

**ì‘ë™ ë°©ì‹:**
```
ë¸Œë¼ìš°ì € (localhost:5173)
    â†“ GET /socket.io/?EIO=4&transport=polling
Vite Dev Server (í”„ë¡ì‹œ)
    â†“ ìš”ì²­ ì „ë‹¬
Backend Server (localhost:3000)
```

**ì¥ì :**
- CORS ë¬¸ì œ í•´ê²°
- ê°œë°œ í™˜ê²½ ë‹¨ìˆœí™”
- WebSocket ì—°ê²° ì§€ì›

### 3. TypeScript íƒ€ì… ì •ì˜

#### íŒŒì¼: `packages/client/src/vite-env.d.ts`

```typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_SERVER_URL?: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

**ì´ìœ :**
- TypeScriptê°€ `import.meta.env`ë¥¼ ì¸ì‹í•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œ í•´ê²°
- í™˜ê²½ë³€ìˆ˜ì— íƒ€ì… ì•ˆì •ì„± ì¶”ê°€
- IDE ìë™ì™„ì„± ì§€ì›

### 4. Svelte 5 Runes í™œìš©

#### ë°˜ì‘í˜• ìƒíƒœ ê´€ë¦¬

```typescript
let connected = $state(false);
let roomCode = $state("");
let nickname = $state("");
let statusMessage = $state("ì„œë²„ì— ì—°ê²°ë˜ì§€ ì•ŠìŒ");
let players = $state<any[]>([]);
let currentRoom = $state<any>(null);
```

**Svelte 5 Runes íŠ¹ì§•:**
- `$state`: ë°˜ì‘í˜• ìƒíƒœ ì„ ì–¸ (ì´ì „ì˜ `let` + `$:`)
- ìë™ ì˜ì¡´ì„± ì¶”ì 
- ë” ì§ê´€ì ì¸ ë¬¸ë²•
- ì„±ëŠ¥ ìµœì í™”

#### ì¡°ê±´ë¶€ ë Œë”ë§

```svelte
{#if !currentRoom}
  <!-- ë°© ìƒì„±/ì°¸ê°€ í¼ -->
  <div class="form-container">...</div>
{:else}
  <!-- ë°© ì •ë³´ -->
  <div class="room-info">...</div>
{/if}
```

### 5. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ êµ¬ì¡°

#### ì—°ê²° ê´€ë¦¬

```typescript
onMount(() => {
  socket = initSocket();

  // ì—°ê²° ì´ë²¤íŠ¸
  socket.on("connect", () => {
    connected = true;
    statusMessage = `âœ… ì„œë²„ ì—°ê²° ì„±ê³µ! (ID: ${socket.id})`;
  });

  socket.on("disconnect", () => {
    connected = false;
    statusMessage = "âŒ ì„œë²„ ì—°ê²° ëŠê¹€";
  });

  socket.on("connect_error", (error) => {
    statusMessage = `âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`;
  });

  // ì„œë²„ ì—°ê²° ì‹œì‘
  socket.connect();

  // ì»´í¬ë„ŒíŠ¸ ì •ë¦¬
  return () => {
    socket.disconnect();
  };
});
```

**ì„¤ê³„ íŒ¨í„´:**
- **onMount**: ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì†Œì¼“ ì´ˆê¸°í™”
- **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡**: ëª¨ë“  ì„œë²„ ì´ë²¤íŠ¸ ì²˜ë¦¬
- **í´ë¦°ì—… í•¨ìˆ˜**: ì–¸ë§ˆìš´íŠ¸ ì‹œ ì—°ê²° í•´ì œ (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)

#### ë°© ìƒì„±

```typescript
function createRoom() {
  if (!nickname.trim()) {
    statusMessage = "âš ï¸ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”";
    return;
  }

  statusMessage = "â³ ë°© ìƒì„± ì¤‘...";

  socket.emit("create-room", {
    nickname: nickname.trim(),
    settings: {
      maxPlayers: 8,
      roundInterval: 30,
      playlistId: "test-playlist"
    }
  }, (response: any) => {
    if (response.success) {
      currentRoom = response.room;
      roomCode = response.room.code;
      players = response.room.players;
      statusMessage = `âœ… ë°© ìƒì„± ì™„ë£Œ! ì½”ë“œ: ${response.room.code}`;
    } else {
      statusMessage = `âŒ ë°© ìƒì„± ì‹¤íŒ¨: ${response.error}`;
    }
  });
}
```

**ì—ëŸ¬ ì²˜ë¦¬:**
- ì…ë ¥ê°’ ê²€ì¦ (í”„ë¡ íŠ¸ì—”ë“œ)
- ë¡œë”© ìƒíƒœ í‘œì‹œ
- ì„œë²„ ì‘ë‹µ ì²˜ë¦¬ (ì„±ê³µ/ì‹¤íŒ¨)
- ì‚¬ìš©ì í”¼ë“œë°±

#### ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìˆ˜ì‹ 

```typescript
// í”Œë ˆì´ì–´ ì°¸ê°€ ì•Œë¦¼
socket.on("player-joined", (data) => {
  statusMessage = `ğŸ® ${data.player.nickname}ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤!`;
  if (currentRoom) {
    players = [...players, data.player];
  }
});

// í”Œë ˆì´ì–´ í‡´ì¥ ì•Œë¦¼
socket.on("player-left", (data) => {
  statusMessage = `ğŸ‘‹ í”Œë ˆì´ì–´ê°€ í‡´ì¥í–ˆìŠµë‹ˆë‹¤`;
  players = players.filter(p => p.id !== data.playerId);
});
```

**ë¶ˆë³€ì„± ìœ ì§€:**
- `players = [...players, newPlayer]` (ìƒˆ ë°°ì—´ ìƒì„±)
- Svelteì˜ ë°˜ì‘ì„± ë³´ì¥

---

## ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: `xhr poll error` - CORS ë° ì—°ê²° ì‹¤íŒ¨

#### ì¦ìƒ
```javascript
TransportError: xhr poll error
    at XHR.onError
    at Request._onError
```

ë¸Œë¼ìš°ì € ì½˜ì†”ì— ìœ„ ì—ëŸ¬ê°€ ì¶œë ¥ë˜ê³  ì„œë²„ ì—°ê²° ì‹¤íŒ¨.

#### ì›ì¸ ë¶„ì„

1. **ì§ì ‘ ì—°ê²° ì‹œë„**:
   ```typescript
   // ë¬¸ì œ ì½”ë“œ
   socket = io("http://localhost:3000", { ... });
   ```
   - í´ë¼ì´ì–¸íŠ¸: `http://localhost:5173` (Vite Dev Server)
   - ì„œë²„: `http://localhost:3000` (Express + Socket.IO)
   - **Cross-Origin**: ë‹¤ë¥¸ í¬íŠ¸ = CORS ì •ì±… ìœ„ë°˜

2. **CORS ì„¤ì • í™•ì¸**:
   ```typescript
   // packages/server/src/index.ts
   const io = new Server(httpServer, {
     cors: {
       origin: "http://localhost:5173",
       methods: ["GET", "POST"],
     },
   });
   ```
   - CORSëŠ” ì„¤ì •ë˜ì–´ ìˆì—ˆì§€ë§Œ í´ë¼ì´ì–¸íŠ¸ê°€ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

3. **Vite í”„ë¡ì‹œ ë¯¸ì‚¬ìš©**:
   - `vite.config.ts`ì— í”„ë¡ì‹œ ì„¤ì •ì€ ìˆì—ˆì§€ë§Œ
   - í´ë¼ì´ì–¸íŠ¸ê°€ ì ˆëŒ€ URLë¡œ ì§ì ‘ ì—°ê²° ì‹œë„

#### í•´ê²° ë°©ë²•

**socket.ts ìˆ˜ì •**:
```typescript
// Before
socket = io("http://localhost:3000", { autoConnect: false });

// After
const serverUrl = import.meta.env.VITE_SERVER_URL || "";
socket = io(serverUrl, {
  autoConnect: false,
  path: "/socket.io",
});
```

**ì‘ë™ ì›ë¦¬**:
```
í´ë¼ì´ì–¸íŠ¸ ìš”ì²­: io("")
    â†“
ìƒëŒ€ ê²½ë¡œ: GET http://localhost:5173/socket.io/
    â†“
Vite í”„ë¡ì‹œ: /socket.io â†’ http://localhost:3000/socket.io
    â†“
ì„œë²„ ì‘ë‹µ: 200 OK
    â†“
WebSocket ì—…ê·¸ë ˆì´ë“œ ì„±ê³µ
```

**ê²°ê³¼**:
- âœ… CORS ë¬¸ì œ í•´ê²°
- âœ… ë™ì¼ ì¶œì²˜(Same-Origin)ë¡œ ì¸ì‹
- âœ… WebSocket ì—°ê²° ì„±ê³µ

### ë¬¸ì œ 2: TypeScript íƒ€ì… ì—ëŸ¬ - `import.meta.env`

#### ì¦ìƒ
```
'ImportMeta' í˜•ì‹ì— 'env' ì†ì„±ì´ ì—†ìŠµë‹ˆë‹¤. [2339]
```

VS Codeì—ì„œ `import.meta.env.VITE_SERVER_URL` ì‚¬ìš© ì‹œ ë¹¨ê°„ ë°‘ì¤„.

#### ì›ì¸
TypeScriptê°€ Viteì˜ í™˜ê²½ë³€ìˆ˜ íƒ€ì…ì„ ì¸ì‹í•˜ì§€ ëª»í•¨.

#### í•´ê²° ë°©ë²•

**1. `vite-env.d.ts` ìƒì„±**:
```typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_SERVER_URL?: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

**2. `tsconfig.json` ìˆ˜ì •**:
```json
{
  "compilerOptions": {
    "types": ["svelte", "vite/client"]  // vite/client ì¶”ê°€
  },
  "include": ["src/**/*.d.ts", ...]  // *.d.ts í¬í•¨ í™•ì¸
}
```

**ê²°ê³¼**:
- âœ… íƒ€ì… ì²´í¬ í†µê³¼
- âœ… ìë™ì™„ì„± ì§€ì›
- âœ… ë¹Œë“œ ì—ëŸ¬ ì—†ìŒ

### ë¬¸ì œ 3: ì„œë²„ ë¹Œë“œ ì—ëŸ¬ - ëª¨ë“ˆ í•´ìƒë„

#### ì¦ìƒ
```
error TS2835: Relative import paths need explicit file extensions
Did you mean './config/env.js'?
```

`moduleResolution: "node16"`ìœ¼ë¡œ ë³€ê²½ í›„ ëª¨ë“  importì—ì„œ ì—ëŸ¬.

#### ì›ì¸
- Node16/NodeNext ëª¨ë“ˆ í•´ìƒë„ëŠ” ESM í‘œì¤€ ì¤€ìˆ˜
- ìƒëŒ€ ê²½ë¡œì— ëª…ì‹œì  `.js` í™•ì¥ì í•„ìš”

#### í•´ê²° ë°©ë²•

**ëª¨ë“  ìƒëŒ€ importì— `.js` ì¶”ê°€**:
```typescript
// Before
import { config } from "./config/env";
import { roomService } from "./services/room";

// After
import { config } from "./config/env.js";
import { roomService } from "./services/room.js";
```

**tsconfig.json ì—…ë°ì´íŠ¸**:
```json
{
  "compilerOptions": {
    "module": "nodenext",
    "moduleResolution": "nodenext"
  }
}
```

**ê²°ê³¼**:
- âœ… ì„œë²„ ë¹Œë“œ ì„±ê³µ
- âœ… ESM í‘œì¤€ ì¤€ìˆ˜
- âœ… Node.js ìµœì‹  ê¸°ëŠ¥ ì‚¬ìš© ê°€ëŠ¥

---

## í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

### 1. ì‹¤í–‰ ë°©ë²•

#### í„°ë¯¸ë„ 1: ì„œë²„ ì‹¤í–‰
```bash
npm run dev:server
```

**í™•ì¸ ì‚¬í•­:**
```
Server running on http://localhost:3000
Socket.IO Ready
```

#### í„°ë¯¸ë„ 2: í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰
```bash
npm run dev:client
```

**ìë™ ì‹¤í–‰:**
- ë¸Œë¼ìš°ì € ìë™ ì˜¤í”ˆ: `http://localhost:5173`
- ì„œë²„ ìë™ ì—°ê²°
- ì´ˆë¡ìƒ‰ ìƒíƒœë°”: ì—°ê²° ì„±ê³µ

### 2. í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ë‹¨ì¼ í”Œë ˆì´ì–´ í…ŒìŠ¤íŠ¸

**ë‹¨ê³„:**
1. ë¸Œë¼ìš°ì € ì˜¤í”ˆ â†’ `http://localhost:5173`
2. ìƒíƒœ í™•ì¸: "âœ… ì„œë²„ ì—°ê²° ì„±ê³µ!"
3. ë‹‰ë„¤ì„ ì…ë ¥: "í”Œë ˆì´ì–´1"
4. "ğŸ  ìƒˆ ë°© ë§Œë“¤ê¸°" í´ë¦­
5. ë°© ì½”ë“œ í™•ì¸: ì˜ˆ) `ABC123`
6. ë°© ì •ë³´ í™•ì¸:
   - ë°©ì¥: í”Œë ˆì´ì–´1 (ğŸ‘‘ í‘œì‹œ)
   - í”Œë ˆì´ì–´: 1 / 8ëª…
   - ë¼ìš´ë“œ ì‹œê°„: 30ì´ˆ

**ì˜ˆìƒ ê²°ê³¼:**
```
ğŸ  ë°© ì •ë³´

ë°© ì½”ë“œ: ABC123
ë°©ì¥: í”Œë ˆì´ì–´1
í”Œë ˆì´ì–´: 1 / 8ëª…

ğŸ‘¥ ì°¸ê°€ì ëª©ë¡
[ğŸ˜€] í”Œë ˆì´ì–´1 ğŸ‘‘
```

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ë©€í‹°í”Œë ˆì´ì–´ í…ŒìŠ¤íŠ¸

**ë‹¨ê³„:**
1. **ì²« ë²ˆì§¸ ë¸Œë¼ìš°ì €**: ë°© ìƒì„± (ìœ„ ì‹œë‚˜ë¦¬ì˜¤ 1)
2. **ë‘ ë²ˆì§¸ ë¸Œë¼ìš°ì €** (ì‹œí¬ë¦¿ ëª¨ë“œ):
   - `http://localhost:5173` ì ‘ì†
   - ë‹‰ë„¤ì„: "í”Œë ˆì´ì–´2"
   - ë°© ì½”ë“œ: `ABC123` (ì²« ë²ˆì§¸ ì°½ ì½”ë“œ ë³µì‚¬)
   - "ğŸšª ë°© ì°¸ê°€í•˜ê¸°" í´ë¦­

**ì˜ˆìƒ ê²°ê³¼:**

**ë‘ ë²ˆì§¸ ì°½ (ì°¸ê°€ì):**
```
âœ… ë°© ì°¸ê°€ ì™„ë£Œ! (2ëª…)

[ğŸ˜€] í”Œë ˆì´ì–´1 ğŸ‘‘
[ğŸ˜] í”Œë ˆì´ì–´2
```

**ì²« ë²ˆì§¸ ì°½ (ë°©ì¥):**
```
ğŸ® í”Œë ˆì´ì–´2ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤!

[ğŸ˜€] í”Œë ˆì´ì–´1 ğŸ‘‘
[ğŸ˜] í”Œë ˆì´ì–´2
```

**ì„œë²„ ë¡œê·¸:**
```
âœ… Client connected: xyz123
âœ… Room created: ABC123 by í”Œë ˆì´ì–´1
âœ… Client connected: xyz456
âœ… Player í”Œë ˆì´ì–´2 joined room ABC123
```

#### ì‹œë‚˜ë¦¬ì˜¤ 3: ë°©ì¥ ìë™ ìœ„ì„

**ë‹¨ê³„:**
1. í”Œë ˆì´ì–´1(ë°©ì¥), í”Œë ˆì´ì–´2 ì°¸ê°€ ìƒíƒœ
2. **í”Œë ˆì´ì–´1 ë¸Œë¼ìš°ì €**: "ğŸšª ë°© ë‚˜ê°€ê¸°" í´ë¦­
3. **í”Œë ˆì´ì–´2 ë¸Œë¼ìš°ì €** í™•ì¸

**ì˜ˆìƒ ê²°ê³¼:**

**í”Œë ˆì´ì–´1:**
```
ğŸ‘‹ ë°©ì„ ë‚˜ê°”ìŠµë‹ˆë‹¤
(ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ë³µê·€)
```

**í”Œë ˆì´ì–´2:**
```
ğŸ‘‹ í”Œë ˆì´ì–´ê°€ í‡´ì¥í–ˆìŠµë‹ˆë‹¤

[ğŸ˜] í”Œë ˆì´ì–´2 ğŸ‘‘  â† ìƒˆë¡œìš´ ë°©ì¥
```

#### ì‹œë‚˜ë¦¬ì˜¤ 4: ì—ëŸ¬ ì²˜ë¦¬

**í…ŒìŠ¤íŠ¸ 4-1: ì¤‘ë³µ ë‹‰ë„¤ì„**
```
ë°© ìƒíƒœ: í”Œë ˆì´ì–´1, í”Œë ˆì´ì–´2 ì°¸ê°€ ì¤‘
ì‹œë„: ìƒˆ ë¸Œë¼ìš°ì €ì—ì„œ "í”Œë ˆì´ì–´1"ë¡œ ì°¸ê°€

ê²°ê³¼: âŒ ë°© ì°¸ê°€ ì‹¤íŒ¨: ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤
```

**í…ŒìŠ¤íŠ¸ 4-2: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°©**
```
ì‹œë„: ë°© ì½”ë“œ "XXXXXX" ì…ë ¥ í›„ ì°¸ê°€

ê²°ê³¼: âŒ ë°© ì°¸ê°€ ì‹¤íŒ¨: ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
```

**í…ŒìŠ¤íŠ¸ 4-3: ë¹ˆ ì…ë ¥ê°’**
```
ì‹œë„: ë‹‰ë„¤ì„ ì—†ì´ ë°© ìƒì„±

ê²°ê³¼: âš ï¸ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”
ë²„íŠ¼: ë¹„í™œì„±í™” ìƒíƒœ ìœ ì§€
```

### 3. ë””ë²„ê¹…

#### ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ (F12)

**Console íƒ­:**
```javascript
ì„œë²„ ì—°ê²°: xyz123abc
ë°© ìƒì„± ì„±ê³µ: {
  code: "ABC123",
  players: [{ id: "xyz123", nickname: "í”Œë ˆì´ì–´1", ... }],
  settings: { maxPlayers: 8, ... }
}
ìƒˆ í”Œë ˆì´ì–´ ì°¸ê°€: {
  player: { id: "def456", nickname: "í”Œë ˆì´ì–´2", ... },
  playerCount: 2
}
```

**Network íƒ­:**
```
WS    /socket.io/?EIO=4&transport=websocket
Status: 101 Switching Protocols
Protocol: websocket
```

**Application íƒ­:**
- Local Storage: (ì—†ìŒ - ìƒíƒœëŠ” ë©”ëª¨ë¦¬ì—ë§Œ)
- Session Storage: (ì—†ìŒ)

#### ì„œë²„ ë¡œê·¸

```bash
âœ… Client connected: xyz123abc
Room ABC123 created by í”Œë ˆì´ì–´1
âœ… Client connected: def456ghi
âœ… Player í”Œë ˆì´ì–´2 joined room ABC123
âœ… Player left room ABC123
ğŸ‘‘ New host: í”Œë ˆì´ì–´2 in room ABC123
âŒ Client disconnected: xyz123abc
```

---

## ì½”ë“œ êµ¬ì¡°

### 1. í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ê´€ë¦¬

```typescript
// ì „ì—­ ìƒíƒœ (Svelte Runes)
let socket: Socket;                    // Socket.IO ì¸ìŠ¤í„´ìŠ¤
let connected = $state(false);         // ì—°ê²° ìƒíƒœ
let roomCode = $state("");             // ë°© ì½”ë“œ ì…ë ¥
let nickname = $state("");             // ë‹‰ë„¤ì„ ì…ë ¥
let statusMessage = $state("");        // ìƒíƒœ ë©”ì‹œì§€
let players = $state<any[]>([]);       // í”Œë ˆì´ì–´ ëª©ë¡
let currentRoom = $state<any>(null);   // í˜„ì¬ ë°© ì •ë³´
```

**ìƒíƒœ ì „ì´ ë‹¤ì´ì–´ê·¸ë¨:**
```
ì´ˆê¸° ìƒíƒœ
    â†“
connected = true
    â†“
currentRoom = null (ëŒ€ê¸°ì‹¤)
    â†“
currentRoom = Room (ë°© ì…ì¥)
    â†“
currentRoom = null (ë°© í‡´ì¥)
```

### 2. UI ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
App.svelte
â”œâ”€ StatusBar (ì—°ê²° ìƒíƒœ)
â”‚  â”œâ”€ Indicator (ë¹¨ê°•/ì´ˆë¡)
â”‚  â””â”€ Message (ìƒíƒœ í…ìŠ¤íŠ¸)
â”‚
â”œâ”€ Form Container (currentRoom === null)
â”‚  â”œâ”€ Nickname Input
â”‚  â”œâ”€ Create Room Section
â”‚  â”‚  â””â”€ Create Button
â”‚  â”œâ”€ Divider
â”‚  â””â”€ Join Room Section
â”‚     â”œâ”€ Room Code Input
â”‚     â””â”€ Join Button
â”‚
â”œâ”€ Room Info (currentRoom !== null)
â”‚  â”œâ”€ Room Details
â”‚  â”‚  â”œâ”€ Room Code
â”‚  â”‚  â”œâ”€ Host Name
â”‚  â”‚  â”œâ”€ Player Count
â”‚  â”‚  â””â”€ Round Interval
â”‚  â”œâ”€ Player List
â”‚  â”‚  â””â”€ Player Cards
â”‚  â”‚     â”œâ”€ Avatar
â”‚  â”‚     â”œâ”€ Nickname
â”‚  â”‚     â””â”€ Host Badge (ì¡°ê±´ë¶€)
â”‚  â””â”€ Leave Button
â”‚
â””â”€ Info Footer
```

### 3. ì´ë²¤íŠ¸ íë¦„ ì°¨íŠ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Client (Browser)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  App.svelte                                                 â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€ onMount()                                             â”‚
â”‚    â”‚   â”œâ”€ socket = initSocket()                             â”‚
â”‚    â”‚   â”œâ”€ socket.on("connect", ...)                         â”‚
â”‚    â”‚   â”œâ”€ socket.on("player-joined", ...)                   â”‚
â”‚    â”‚   â””â”€ socket.connect()                                  â”‚
â”‚    â”‚                                                         â”‚
â”‚    â”œâ”€ createRoom()                                          â”‚
â”‚    â”‚   â””â”€ emit("create-room") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚    â”‚                                         â”‚               â”‚
â”‚    â”œâ”€ joinRoom()                             â”‚               â”‚
â”‚    â”‚   â””â”€ emit("join-room") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚               â”‚
â”‚    â”‚                                      â”‚  â”‚               â”‚
â”‚    â””â”€ leaveRoom()                         â”‚  â”‚               â”‚
â”‚        â””â”€ emit("leave-room") â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚  â”‚  â”‚
                    Socket.IO (WebSocket) â”‚  â”‚  â”‚
                                         â”‚  â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Server (Node.js)  â”‚  â”‚  â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  room.handler.ts                       â”‚  â”‚  â”‚               â”‚
â”‚    â”‚                                    â”‚  â”‚  â”‚               â”‚
â”‚    â”œâ”€ handleCreateRoom() â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚               â”‚
â”‚    â”‚   â”œâ”€ roomService.createRoom()        â”‚  â”‚               â”‚
â”‚    â”‚   â”œâ”€ socket.join(code)                â”‚  â”‚               â”‚
â”‚    â”‚   â””â”€ callback({ success, room })      â”‚  â”‚               â”‚
â”‚    â”‚                                        â”‚  â”‚               â”‚
â”‚    â”œâ”€ handleJoinRoom() â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚               â”‚
â”‚    â”‚   â”œâ”€ roomService.joinRoom()               â”‚               â”‚
â”‚    â”‚   â”œâ”€ socket.join(code)                    â”‚               â”‚
â”‚    â”‚   â”œâ”€ callback({ success, room })          â”‚               â”‚
â”‚    â”‚   â””â”€ emit("player-joined") â”€â”€â”€â”€â”€â”€â”€â”       â”‚               â”‚
â”‚    â”‚                                    â”‚       â”‚               â”‚
â”‚    â””â”€ handleLeaveRoom() â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚        â”œâ”€ roomService.leaveRoom()      â”‚                       â”‚
â”‚        â”œâ”€ socket.leave(code)           â”‚                       â”‚
â”‚        â”œâ”€ callback({ success })        â”‚                       â”‚
â”‚        â””â”€ emit("player-left") â”€â”€â”€â”€â”€â”   â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚   â”‚
                    Socket.IO Broadcast  â”‚
                                     â”‚   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Other Clients     â”‚   â”‚                       â”‚
â”‚                                    â”‚   â”‚                       â”‚
â”‚  socket.on("player-joined") â—„â”€â”€â”€â”€â”€â”€â”˜   â”‚                       â”‚
â”‚  socket.on("player-left") â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. ë°ì´í„° ì§ë ¬í™”

#### ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸

**ë¬¸ì œ**: Map ê°ì²´ëŠ” JSON ì§ë ¬í™” ë¶ˆê°€
```javascript
JSON.stringify(new Map([["a", 1]]))  // "{}" â† ë¹ˆ ê°ì²´!
```

**í•´ê²°**: ì„œë²„ì—ì„œ ì§ë ¬í™” (room.handler.ts)
```typescript
function serializeRoom(room: Room): SerializedRoom {
  return {
    code: room.code,
    hostId: room.hostId,
    players: Array.from(room.players.values()),  // Map â†’ Array
    settings: room.settings,
    gameState: {
      ...room.gameState,
      answers: Array.from(room.gameState.answers.entries()),
      scores: Array.from(room.gameState.scores.entries()),
      streaks: Array.from(room.gameState.streaks.entries()),
    },
    createdAt: room.createdAt,
  };
}
```

**í´ë¼ì´ì–¸íŠ¸ ìˆ˜ì‹ :**
```typescript
socket.emit("create-room", data, (response) => {
  if (response.success) {
    currentRoom = response.room;  // ì´ë¯¸ ì§ë ¬í™”ëœ ë°ì´í„°
    players = response.room.players;  // Array í˜•íƒœ
  }
});
```

---

## í–¥í›„ ê°œì„  ì‚¬í•­

### 1. ê¸°ëŠ¥ í™•ì¥

#### 1.1 ê²Œì„ ë¡œì§ êµ¬í˜„
- [ ] íŠ¸ë™ ì¬ìƒ (YouTube IFrame API)
- [ ] ì •ë‹µ ì œì¶œ (ì…ë ¥ì°½ + íƒ€ì´ë¨¸)
- [ ] ì ìˆ˜ ê³„ì‚° ë° í‘œì‹œ
- [ ] ë¼ìš´ë“œ ì§„í–‰ ì‹œìŠ¤í…œ
- [ ] ê²Œì„ ì¢…ë£Œ ë° ê²°ê³¼ í™”ë©´

#### 1.2 ì±„íŒ… ê¸°ëŠ¥
```typescript
// ì´ë²¤íŠ¸ ì¶”ê°€
socket.emit("send-message", {
  roomCode: "ABC123",
  message: "ì•ˆë…•í•˜ì„¸ìš”!"
});

socket.on("new-message", (data) => {
  // { nickname, message, timestamp }
  addMessageToChat(data);
});
```

#### 1.3 ë°© ì„¤ì • UI
- [ ] ìµœëŒ€ í”Œë ˆì´ì–´ ìˆ˜ ì¡°ì ˆ (ìŠ¬ë¼ì´ë”)
- [ ] ë¼ìš´ë“œ ì‹œê°„ ì„¤ì • (10~60ì´ˆ)
- [ ] í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„ íƒ (ë“œë¡­ë‹¤ìš´)
- [ ] ë‚œì´ë„ ì„ íƒ (ì‰¬ì›€/ë³´í†µ/ì–´ë ¤ì›€)

#### 1.4 í”Œë ˆì´ì–´ ê´€ë¦¬
- [ ] í”Œë ˆì´ì–´ ê°•í‡´ (ë°©ì¥ ê¶Œí•œ)
- [ ] ì¤€ë¹„ ìƒíƒœ í‘œì‹œ (Ready/Not Ready)
- [ ] í”Œë ˆì´ì–´ í”„ë¡œí•„ (í†µê³„, ì•„ë°”íƒ€ ë³€ê²½)

### 2. UX ê°œì„ 

#### 2.1 ì• ë‹ˆë©”ì´ì…˜
```css
/* í”Œë ˆì´ì–´ ì…ì¥ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes slideIn {
  from {
    transform: translateX(-100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.player-card {
  animation: slideIn 0.3s ease-out;
}
```

#### 2.2 í† ìŠ¤íŠ¸ ì•Œë¦¼
```typescript
function showToast(message: string, type: "success" | "error") {
  // í™”ë©´ ìš°ì¸¡ ìƒë‹¨ì— ì•Œë¦¼ í‘œì‹œ
  // 3ì´ˆ í›„ ìë™ ì‚¬ë¼ì§
}

socket.on("player-joined", (data) => {
  showToast(`${data.player.nickname}ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤!`, "success");
});
```

#### 2.3 ë°˜ì‘í˜• ë””ìì¸
```css
/* ëª¨ë°”ì¼ ëŒ€ì‘ */
@media (max-width: 640px) {
  main {
    padding: 1rem;
  }

  .room-code {
    font-size: 1.2rem;
  }

  .player-card {
    padding: 0.75rem;
  }
}
```

### 3. ì„±ëŠ¥ ìµœì í™”

#### 3.1 ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬
```
src/
â”œâ”€â”€ App.svelte
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ StatusBar.svelte
â”‚   â”œâ”€â”€ CreateRoomForm.svelte
â”‚   â”œâ”€â”€ JoinRoomForm.svelte
â”‚   â”œâ”€â”€ RoomInfo.svelte
â”‚   â””â”€â”€ PlayerList.svelte
â””â”€â”€ lib/
    â”œâ”€â”€ socket.ts
    â””â”€â”€ types.ts
```

#### 3.2 íƒ€ì… ì •ì˜ ê°œì„ 
```typescript
// types.ts
export interface Player {
  id: string;
  nickname: string;
  avatar: string;
  score: number;
  streak: number;
  isHost: boolean;
  joinedAt: number;
}

export interface Room {
  code: string;
  hostId: string;
  players: Player[];
  settings: RoomSettings;
  gameState: GameState;
  createdAt: number;
}
```

#### 3.3 ë©”ëª¨ì´ì œì´ì…˜
```typescript
// Svelte 5 $derived ì‚¬ìš©
let hostPlayer = $derived(
  players.find(p => p.isHost)
);

let playerCount = $derived(
  `${players.length} / ${currentRoom?.settings.maxPlayers || 8}ëª…`
);
```

### 4. ë³´ì•ˆ ê°•í™”

#### 4.1 ì…ë ¥ê°’ ê²€ì¦ ê°•í™”
```typescript
function isValidNickname(nickname: string): boolean {
  // 2-10ì, íŠ¹ìˆ˜ë¬¸ì ì œí•œ
  return /^[a-zA-Z0-9ê°€-í£]{2,10}$/.test(nickname);
}

function isValidRoomCode(code: string): boolean {
  // 6ìë¦¬ ëŒ€ë¬¸ì ì˜ë¬¸ì
  return /^[A-Z]{6}$/.test(code);
}
```

#### 4.2 Rate Limiting (í´ë¼ì´ì–¸íŠ¸)
```typescript
let lastRequestTime = 0;
const MIN_REQUEST_INTERVAL = 1000; // 1ì´ˆ

function createRoom() {
  const now = Date.now();
  if (now - lastRequestTime < MIN_REQUEST_INTERVAL) {
    statusMessage = "âš ï¸ ë„ˆë¬´ ë¹ ë¥´ê²Œ ìš”ì²­í•˜ê³  ìˆìŠµë‹ˆë‹¤";
    return;
  }
  lastRequestTime = now;

  // ... ë°© ìƒì„± ë¡œì§
}
```

#### 4.3 XSS ë°©ì§€
```svelte
<!-- ì•ˆì „í•˜ì§€ ì•ŠìŒ -->
<div>{@html userInput}</div>

<!-- ì•ˆì „í•¨ (Svelte ê¸°ë³¸ ë™ì‘) -->
<div>{userInput}</div>

<!-- ë‹‰ë„¤ì„ í•„í„°ë§ -->
<script>
function sanitizeNickname(nickname: string): string {
  return nickname
    .replace(/[<>]/g, '')  // HTML íƒœê·¸ ì œê±°
    .trim();
}
</script>
```

### 5. í…ŒìŠ¤íŠ¸ ì½”ë“œ

#### 5.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Vitest)
```typescript
// socket.test.ts
import { describe, it, expect, beforeEach } from 'vitest';
import { initSocket, getSocket } from './socket';

describe('Socket Management', () => {
  it('should create singleton socket instance', () => {
    const socket1 = initSocket();
    const socket2 = initSocket();
    expect(socket1).toBe(socket2);
  });

  it('should return current socket instance', () => {
    const socket = initSocket();
    expect(getSocket()).toBe(socket);
  });
});
```

#### 5.2 í†µí•© í…ŒìŠ¤íŠ¸
```typescript
// room.test.ts
import { describe, it, expect } from 'vitest';
import { io, Socket } from 'socket.io-client';

describe('Room Operations', () => {
  let socket: Socket;

  beforeEach(() => {
    socket = io('http://localhost:3000', { autoConnect: false });
    socket.connect();
  });

  it('should create room successfully', (done) => {
    socket.emit('create-room', {
      nickname: 'TestPlayer',
      settings: { maxPlayers: 8, roundInterval: 30, playlistId: 'test' }
    }, (response) => {
      expect(response.success).toBe(true);
      expect(response.room.code).toHaveLength(6);
      done();
    });
  });
});
```

### 6. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

#### 6.1 í´ë¼ì´ì–¸íŠ¸ ë¡œê¹…
```typescript
// logger.ts
export function logEvent(event: string, data?: any) {
  const timestamp = new Date().toISOString();
  console.log(`[${timestamp}] ${event}:`, data);

  // í”„ë¡œë•ì…˜: ë¡œê¹… ì„œë¹„ìŠ¤ë¡œ ì „ì†¡
  if (import.meta.env.PROD) {
    sendToAnalytics(event, data);
  }
}

// ì‚¬ìš©
socket.on('player-joined', (data) => {
  logEvent('PLAYER_JOINED', data);
  // ...
});
```

#### 6.2 ì—ëŸ¬ ì¶”ì 
```typescript
window.addEventListener('error', (event) => {
  console.error('Global error:', event.error);

  // Sentry, LogRocket ë“±ìœ¼ë¡œ ì „ì†¡
  if (import.meta.env.PROD) {
    captureException(event.error);
  }
});
```

---

## ê²°ë¡ 

### ë‹¬ì„±í•œ ëª©í‘œ

1. âœ… **ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„**: Socket.IOë¥¼ í†µí•œ ì•ˆì •ì ì¸ ì–‘ë°©í–¥ í†µì‹ 
2. âœ… **ë°© ê´€ë¦¬ ì‹œìŠ¤í…œ**: ìƒì„±/ì°¸ê°€/í‡´ì¥ ì™„ë²½ ì‘ë™
3. âœ… **ì‹¤ì‹œê°„ ë™ê¸°í™”**: í”Œë ˆì´ì–´ ëª©ë¡, ë°©ì¥ ìœ„ì„ ì¦‰ì‹œ ë°˜ì˜
4. âœ… **ì—ëŸ¬ ì²˜ë¦¬**: ëª¨ë“  ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ë° ì‚¬ìš©ì í”¼ë“œë°±
5. âœ… **íƒ€ì… ì•ˆì •ì„±**: TypeScriptë¡œ ì•ˆì „í•œ ê°œë°œ í™˜ê²½ êµ¬ì¶•
6. âœ… **ê°œë°œ í™˜ê²½ ì„¤ì •**: Vite í”„ë¡ì‹œ, CORS í•´ê²°

### í•™ìŠµí•œ ë‚´ìš©

1. **Socket.IO í•µì‹¬ ê°œë…**
   - ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ 
   - ë£¸(Room) ë¸Œë¡œë“œìºìŠ¤íŒ…
   - Callback íŒ¨í„´
   - ìë™ ì¬ì—°ê²°

2. **Svelte 5 Runes**
   - `$state`: ë°˜ì‘í˜• ìƒíƒœ ê´€ë¦¬
   - ì¡°ê±´ë¶€ ë Œë”ë§
   - ì´ë²¤íŠ¸ í•¸ë“¤ë§

3. **Vite ê°œë°œ í™˜ê²½**
   - í”„ë¡ì‹œ ì„¤ì •ìœ¼ë¡œ CORS íšŒí”¼
   - HMR (Hot Module Replacement)
   - í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬

4. **TypeScript ê³ ê¸‰ í™œìš©**
   - íƒ€ì… ì •ì˜ íŒŒì¼ (.d.ts)
   - í™˜ê²½ë³€ìˆ˜ íƒ€ì…í™”
   - ì œë„¤ë¦­ í™œìš©

### ë‹¤ìŒ ë‹¨ê³„

1. **ê²Œì„ ë¡œì§ êµ¬í˜„** (ìš°ì„ ìˆœìœ„: ë†’ìŒ)
   - YouTube API ì—°ë™
   - íŠ¸ë™ ì¬ìƒ ë° ì œì–´
   - ì •ë‹µ ì œì¶œ ì‹œìŠ¤í…œ
   - ì ìˆ˜ ê³„ì‚°

2. **UI/UX ê°œì„ ** (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)
   - ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬
   - ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
   - ëª¨ë°”ì¼ ëŒ€ì‘

3. **ë°ì´í„° ì˜êµ¬í™”** (ìš°ì„ ìˆœìœ„: ë‚®ìŒ)
   - Redis ë„ì…
   - ê²Œì„ íˆìŠ¤í† ë¦¬ ì €ì¥
   - ë¦¬ë”ë³´ë“œ

4. **ë°°í¬ ì¤€ë¹„** (ìš°ì„ ìˆœìœ„: ë‚®ìŒ)
   - Docker ì»¨í…Œì´ë„ˆí™”
   - CI/CD íŒŒì´í”„ë¼ì¸
   - ëª¨ë‹ˆí„°ë§ ì„¤ì •

---

## ë¶€ë¡

### A. ì£¼ìš” íŒŒì¼ ì „ì²´ ì½”ë“œ

#### A.1 `packages/client/src/App.svelte`

ì „ì²´ ì½”ë“œëŠ” 445ì¤„ì´ë¯€ë¡œ í•µì‹¬ ë¶€ë¶„ë§Œ ë°œì·Œ:

```svelte
<script lang="ts">
  import { onMount } from "svelte";
  import { initSocket } from "./lib/socket";
  import type { Socket } from "socket.io-client";

  let socket: Socket;
  let connected = $state(false);
  let currentRoom = $state<any>(null);
  let players = $state<any[]>([]);

  onMount(() => {
    socket = initSocket();
    socket.on("connect", () => { connected = true; });
    socket.on("player-joined", (data) => {
      players = [...players, data.player];
    });
    socket.connect();
    return () => { socket.disconnect(); };
  });

  function createRoom() { /* ... */ }
  function joinRoom() { /* ... */ }
  function leaveRoom() { /* ... */ }
</script>

<main>
  <!-- UI ì½”ë“œ -->
</main>

<style>
  /* ìŠ¤íƒ€ì¼ ì½”ë“œ */
</style>
```

#### A.2 `packages/client/src/lib/socket.ts`

```typescript
import { io, Socket } from "socket.io-client";

let socket: Socket | null = null;

export function initSocket(): Socket {
  if (!socket) {
    const serverUrl = import.meta.env.VITE_SERVER_URL || "";
    socket = io(serverUrl, {
      autoConnect: false,
      path: "/socket.io",
    });
  }
  return socket;
}

export function getSocket(): Socket | null {
  return socket;
}
```

#### A.3 `packages/client/vite.config.ts`

```typescript
import { defineConfig } from "vite";
import { svelte } from "@sveltejs/vite-plugin-svelte";

export default defineConfig({
  plugins: [svelte()],
  server: {
    port: 5173,
    proxy: {
      "/socket.io": {
        target: "http://localhost:3000",
        ws: true,
      },
    },
  },
});
```

### B. ì°¸ê³  ìë£Œ

#### ê³µì‹ ë¬¸ì„œ
- Socket.IO: https://socket.io/docs/v4/
- Svelte 5: https://svelte.dev/docs
- Vite: https://vitejs.dev/
- TypeScript: https://www.typescriptlang.org/

#### í”„ë¡œì íŠ¸ ë¬¸ì„œ
- [ë°© ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ë³´ê³ ì„œ](./ROOM_MANAGEMENT_REPORT.md)
- [í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ](../TEST_GUIDE.md)

---

**ì‘ì„±ì**: Claude (AI Assistant)
**ìµœì¢… ìˆ˜ì •ì¼**: 2025-10-23
**ë²„ì „**: 1.0.0
