# í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë‹¤ì¤‘ ì •ë‹µ ê¸°ëŠ¥ ì—…ë°ì´íŠ¸ ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-11-13
**í”„ë¡œì íŠ¸**: ListenUp! - ì‹¤ì‹œê°„ ìŒì•… ë§ì¶”ê¸° ê²Œì„
**ì‘ì—… ë²”ìœ„**: í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ íŠ¸ë™ë³„ ë‹¤ì¤‘ ì •ë‹µ ì‹œìŠ¤í…œ êµ¬í˜„

---

## ëª©ì°¨

1. [ì‘ì—… ê°œìš”](#ì‘ì—…-ê°œìš”)
2. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
3. [Backend êµ¬í˜„](#backend-êµ¬í˜„)
4. [Frontend êµ¬í˜„](#frontend-êµ¬í˜„)
5. [ì •ë‹µ ì²´í¬ ë¡œì§ ê°œì„ ](#ì •ë‹µ-ì²´í¬-ë¡œì§-ê°œì„ )
6. [API ëª…ì„¸](#api-ëª…ì„¸)
7. [ë°ì´í„° ëª¨ë¸](#ë°ì´í„°-ëª¨ë¸)
8. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
9. [í…ŒìŠ¤íŠ¸ ê²°ê³¼](#í…ŒìŠ¤íŠ¸-ê²°ê³¼)
10. [í–¥í›„ ê°œì„  ì‚¬í•­](#í–¥í›„-ê°œì„ -ì‚¬í•­)

---

## ì‘ì—… ê°œìš”

### í”„ë¡œì íŠ¸ ì •ë³´
- **ì‘ì—… ì¼ì**: 2025-11-11
- **ì‘ì—…ì**: ListenUp! Team
- **ëª©ì **: íŠ¸ë™ë³„ ë‹¤ì¤‘ ì •ë‹µ ì‹œìŠ¤í…œ ë„ì…ìœ¼ë¡œ ê²Œì„ ì •í™•ë„ í–¥ìƒ

### êµ¬í˜„ ë°°ê²½

ê¸°ì¡´ ì‹œìŠ¤í…œì€ YouTube ì œëª©ìœ¼ë¡œë§Œ ì •ë‹µì„ ì²´í¬í–ˆìœ¼ë©°, ì´ë¡œ ì¸í•´ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤:

1. **ì •í™•ë„ ë¶€ì¡±**: YouTube ì œëª©ì´ ê¸¸ê³  ë³µì¡í•œ ê²½ìš° (ì˜ˆ: "Rick Astley - Never Gonna Give You Up (Official Music Video)") ì‚¬ìš©ìê°€ ì •í™•íˆ ì…ë ¥í•˜ê¸° ì–´ë ¤ì›€
2. **ë‹¤êµ­ì–´ ì§€ì› ë¶€ì¡±**: í•œê¸€ ì œëª©ì´ë‚˜ ì˜ì–´ ì œëª© ì¤‘ í•˜ë‚˜ë§Œ ì¸ì •ë˜ëŠ” ê²½ìš°
3. **ì•„í‹°ìŠ¤íŠ¸ëª… ì¸ì • ì•ˆë¨**: "PSY"ë§Œ ì…ë ¥í•´ë„ ë§ì•„ì•¼ í•˜ëŠ”ë°, YouTube ì œëª©ì´ "ê°•ë‚¨ìŠ¤íƒ€ì¼"ì¸ ê²½ìš° í‹€ë¦¼

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ **íŠ¸ë™ë³„ë¡œ ì—¬ëŸ¬ ê°œì˜ ì •ë‹µì„ ì§€ì •**í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Client (Vite)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ í˜ì´ì§€                       â”‚     â”‚
â”‚  â”‚  - íŠ¸ë™ ì¶”ê°€ ì‹œ ë‹¤ì¤‘ ì •ë‹µ ì…ë ¥ UI             â”‚     â”‚
â”‚  â”‚  - ê¸°ì¡´ íŠ¸ë™ì˜ ì •ë‹µ ìˆ˜ì • UI                    â”‚     â”‚
â”‚  â”‚  - YouTube URL ìë™ íŒŒì‹±                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Server (Express)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  REST API Endpoints                            â”‚     â”‚
â”‚  â”‚  - POST   /api/playlists/:id/tracks           â”‚     â”‚
â”‚  â”‚    Body: { videoId, answers }                  â”‚     â”‚
â”‚  â”‚  - PUT    /api/playlists/:id/tracks/:videoId  â”‚     â”‚
â”‚  â”‚    Body: { answers }                           â”‚     â”‚
â”‚  â”‚  - DELETE /api/playlists/:id/tracks/:videoId  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  PlaylistService                               â”‚     â”‚
â”‚  â”‚  - addTrack(playlistId, videoId, answers)     â”‚     â”‚
â”‚  â”‚  - updateTrack(playlistId, videoId, answers)  â”‚     â”‚
â”‚  â”‚  - removeTrack(playlistId, videoId)           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  GameService                                   â”‚     â”‚
â”‚  â”‚  - checkAnswer(answer, track)                  â”‚     â”‚
â”‚  â”‚    â†’ track.answers ë°°ì—´ê³¼ ë¹„êµ                â”‚     â”‚
â”‚  â”‚    â†’ ë¹ˆ ë°°ì—´ì´ë©´ track.name ì‚¬ìš© (í•˜ìœ„ í˜¸í™˜) â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  YouTubeService                                â”‚     â”‚
â”‚  â”‚  - getTracks(videoIds, playlistTracks)        â”‚     â”‚
â”‚  â”‚    â†’ Track ê°ì²´ì— answers ë§¤í•‘                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         File System (playlists.json)                     â”‚
â”‚  {                                                       â”‚
â”‚    "test-playlist": {                                    â”‚
â”‚      "tracks": [                                         â”‚
â”‚        {                                                 â”‚
â”‚          "videoId": "dQw4w9WgXcQ",                      â”‚
â”‚          "answers": [                                    â”‚
â”‚            "Never Gonna Give You Up",                    â”‚
â”‚            "Rick Astley",                                â”‚
â”‚            "ë¦­ ì• ìŠ¬ë¦¬"                                   â”‚
â”‚          ]                                               â”‚
â”‚        }                                                 â”‚
â”‚      ]                                                   â”‚
â”‚    }                                                     â”‚
â”‚  }                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„

```
1. ì‚¬ìš©ìê°€ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ íŠ¸ë™ ì¶”ê°€
   â†“
2. YouTube URL ì…ë ¥ â†’ ë¹„ë””ì˜¤ ID ì¶”ì¶œ
   â†“
3. ì„œë²„ì— íŠ¸ë™ ì •ë³´ ìš”ì²­ (GET /api/youtube/track/:videoId)
   â†“
4. ë‹¤ì¤‘ ì •ë‹µ ì…ë ¥ (ì˜ˆ: "Dynamite", "BTS", "ë°©íƒ„ì†Œë…„ë‹¨")
   â†“
5. ì„œë²„ì— íŠ¸ë™ ì¶”ê°€ (POST /api/playlists/:id/tracks)
   Body: { videoId: "...", answers: ["Dynamite", "BTS", "ë°©íƒ„ì†Œë…„ë‹¨"] }
   â†“
6. PlaylistService.addTrack() í˜¸ì¶œ
   â†’ playlists.jsonì— ì €ì¥
   â†“
7. ê²Œì„ ì‹œì‘ ì‹œ:
   - YouTubeService.getTracks()ë¡œ Track ê°ì²´ ìƒì„±
   - playlistTracksì—ì„œ answers ë§¤í•‘
   â†“
8. ì •ë‹µ ì œì¶œ ì‹œ:
   - GameService.checkAnswer(answer, track)
   - track.answers ë°°ì—´ì˜ ëª¨ë“  í•­ëª©ê³¼ ë¹„êµ
   - í•˜ë‚˜ë¼ë„ ë§¤ì¹˜ë˜ë©´ ì •ë‹µ ì¸ì •
```

---

## Backend êµ¬í˜„

### 1. íƒ€ì… ì •ì˜ ì—…ë°ì´íŠ¸

#### types/index.ts

**ìƒˆë¡œìš´ íƒ€ì… ì¶”ê°€**:

```typescript
export interface PlaylistTrack {
  videoId: string;
  answers: string[];  // ì •ë‹µ ëª©ë¡
}
```

**ê¸°ì¡´ íƒ€ì… ìˆ˜ì •**:

```typescript
// Before
export interface Playlist {
  id: string;
  name: string;
  description: string;
  trackIds: string[];  // âŒ ê¸°ì¡´
  roundCount: number;
}

// After
export interface Playlist {
  id: string;
  name: string;
  description: string;
  tracks: PlaylistTrack[];  // âœ… ë³€ê²½
  roundCount: number;
}

// Track íƒ€ì…ì— answers í•„ë“œ ì¶”ê°€
export interface Track {
  id: string;
  name: string;
  artist: string;
  // ... ê¸°íƒ€ í•„ë“œ
  answers: string[];  // âœ… ì¶”ê°€
}
```

**ë³€ê²½ ì´ìœ **:
- `trackIds`ë§Œìœ¼ë¡œëŠ” ì •ë‹µ ì •ë³´ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ìŒ
- `PlaylistTrack` êµ¬ì¡°ë¡œ videoIdì™€ answersë¥¼ í•¨ê»˜ ê´€ë¦¬
- Track ê°ì²´ì— answersë¥¼ í¬í•¨í•˜ì—¬ ê²Œì„ ë¡œì§ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥

---

### 2. PlaylistService ì—…ë°ì´íŠ¸

#### packages/server/src/services/playlist.ts

**ì£¼ìš” ë³€ê²½ ì‚¬í•­**:

```typescript
import { PlaylistTrack } from "../types/index.js";  // âœ… import ì¶”ê°€

export class PlaylistService {
  // ... ê¸°ì¡´ ì½”ë“œ

  // initialize() - tracks êµ¬ì¡° ê²€ì¦
  async initialize(): Promise<void> {
    const playlistsData = JSON.parse(await fs.readFile(this.playlistsFilePath, "utf-8"));

    for (const [key, playlist] of Object.entries(playlistsData)) {
      // âœ… tracks êµ¬ì¡° ê²€ì¦ ì¶”ê°€
      if (playlist.tracks && Array.isArray(playlist.tracks)) {
        this.playlists.set(key, playlist as Playlist);
      } else {
        console.warn(`âš ï¸ Invalid playlist format: ${key}`);
      }
    }
  }

  // createPlaylist() - tracks íŒŒë¼ë¯¸í„°ë¡œ ë³€ê²½
  async createPlaylist(
    name: string,
    description: string,
    tracks: PlaylistTrack[] = []  // âœ… trackIds â†’ tracks
  ): Promise<{ success: boolean; error?: string; playlist?: Playlist }> {
    // ... ê²€ì¦ ë¡œì§

    const playlist: Playlist = {
      id: `custom-${nanoid(8)}`,
      name,
      description,
      tracks,  // âœ… ë³€ê²½
      roundCount: tracks.length,  // âœ… ë³€ê²½
    };

    // ... ì €ì¥ ë¡œì§
  }

  // addTrack() - answers íŒŒë¼ë¯¸í„° ì¶”ê°€ âœ…
  async addTrack(
    playlistId: string,
    videoId: string,
    answers: string[] = []  // âœ… ìƒˆ íŒŒë¼ë¯¸í„°
  ): Promise<{ success: boolean; error?: string; playlist?: Playlist }> {
    const playlist = this.playlists.get(playlistId);
    if (!playlist) {
      return { success: false, error: "í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" };
    }

    // âœ… ì¤‘ë³µ ì²´í¬ (videoId ê¸°ë°˜)
    if (playlist.tracks.some(t => t.videoId === videoId)) {
      return { success: false, error: "ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íŠ¸ë™ì…ë‹ˆë‹¤" };
    }

    const updatedPlaylist: Playlist = {
      ...playlist,
      tracks: [...playlist.tracks, { videoId, answers }],  // âœ… PlaylistTrack ì¶”ê°€
      roundCount: playlist.tracks.length + 1,
    };

    this.playlists.set(playlistId, updatedPlaylist);

    try {
      await this.savePlaylists();
      return { success: true, playlist: updatedPlaylist };
    } catch (error) {
      // ë¡¤ë°±
      this.playlists.set(playlistId, playlist);
      return { success: false, error: "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" };
    }
  }

  // updateTrack() - ìƒˆë¡œ ì¶”ê°€ âœ…
  async updateTrack(
    playlistId: string,
    videoId: string,
    answers: string[]
  ): Promise<{ success: boolean; error?: string; playlist?: Playlist }> {
    const playlist = this.playlists.get(playlistId);
    if (!playlist) {
      return { success: false, error: "í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" };
    }

    const trackIndex = playlist.tracks.findIndex(t => t.videoId === videoId);
    if (trackIndex === -1) {
      return { success: false, error: "íŠ¸ë™ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" };
    }

    const updatedTracks = [...playlist.tracks];
    updatedTracks[trackIndex] = { videoId, answers };

    const updatedPlaylist: Playlist = {
      ...playlist,
      tracks: updatedTracks,
    };

    this.playlists.set(playlistId, updatedPlaylist);

    try {
      await this.savePlaylists();
      return { success: true, playlist: updatedPlaylist };
    } catch (error) {
      this.playlists.set(playlistId, playlist);
      return { success: false, error: "ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" };
    }
  }

  // removeTrack() - videoId íŒŒë¼ë¯¸í„°ë¡œ ë³€ê²½
  async removeTrack(
    playlistId: string,
    videoId: string  // âœ… trackId â†’ videoId
  ): Promise<{ success: boolean; error?: string; playlist?: Playlist }> {
    const playlist = this.playlists.get(playlistId);
    if (!playlist) {
      return { success: false, error: "í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" };
    }

    const updatedPlaylist: Playlist = {
      ...playlist,
      tracks: playlist.tracks.filter(t => t.videoId !== videoId),  // âœ… ë³€ê²½
      roundCount: playlist.tracks.length - 1,
    };

    // ... ì €ì¥ ë¡œì§
  }

  // getStats() - tracks.length ì‚¬ìš©
  getStats() {
    let totalTracks = 0;
    for (const playlist of this.playlists.values()) {
      totalTracks += playlist.tracks.length;  // âœ… trackIds.length â†’ tracks.length
    }
    // ... ë‚˜ë¨¸ì§€ ë¡œì§
  }
}
```

**í•µì‹¬ ê°œì„  ì‚¬í•­**:
1. `tracks: PlaylistTrack[]` êµ¬ì¡°ë¡œ í†µì¼
2. `addTrack()`ì— `answers` íŒŒë¼ë¯¸í„° ì¶”ê°€
3. `updateTrack()` ë©”ì„œë“œ ì‹ ê·œ ì¶”ê°€ (ì •ë‹µ ìˆ˜ì •)
4. ì¤‘ë³µ ì²´í¬ë¥¼ `videoId` ê¸°ë°˜ìœ¼ë¡œ ìˆ˜í–‰

---

### 3. GameService ìˆ˜ì •

#### packages/server/src/services/game.ts

**ì •ë‹µ ì²´í¬ ë¡œì§ ê°œì„ **:

```typescript
// Before: YouTube ì œëª©ê³¼ë§Œ ë¹„êµ
checkAnswer(answer: string, correctAnswer: string): boolean {
  const normalizedUser = this.normalize(answer);
  const normalizedCorrect = this.normalize(correctAnswer);

  // ì™„ì „ ì¼ì¹˜
  if (normalizedUser === normalizedCorrect) return true;

  // ë¶€ë¶„ ì¼ì¹˜ (3ì ì´ìƒ)
  if (normalizedCorrect.includes(normalizedUser) && normalizedUser.length >= 3) {
    return true;
  }

  // ìœ ì‚¬ë„ ì²´í¬
  const similarity = this.calculateSimilarity(normalizedUser, normalizedCorrect);
  return similarity > 0.8;
}
```

```typescript
// After: answers ë°°ì—´ê³¼ ë¹„êµ (Track ê°ì²´ ì „ë‹¬) âœ…
checkAnswer(answer: string, track: Track): boolean {
  const normalizedUser = this.normalize(answer);

  // 1. answers ë°°ì—´ì´ ìˆìœ¼ë©´ ìš°ì„  ì²´í¬
  if (track.answers && track.answers.length > 0) {
    for (const correctAnswer of track.answers) {
      const normalizedCorrect = this.normalize(correctAnswer);

      // ì™„ì „ ì¼ì¹˜
      if (normalizedUser === normalizedCorrect) return true;

      // ë¶€ë¶„ ì¼ì¹˜ (3ì ì´ìƒ)
      if (normalizedCorrect.includes(normalizedUser) && normalizedUser.length >= 3) {
        return true;
      }

      // ìœ ì‚¬ë„ ì²´í¬
      const similarity = this.calculateSimilarity(normalizedUser, normalizedCorrect);
      if (similarity > 0.8) return true;
    }

    // ëª¨ë“  ì •ë‹µê³¼ ë§¤ì¹˜ ì•ˆë¨
    return false;
  }

  // 2. answers ë°°ì—´ì´ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ (track.name ì‚¬ìš©)
  const normalizedCorrect = this.normalize(track.name);

  if (normalizedUser === normalizedCorrect) return true;

  if (normalizedCorrect.includes(normalizedUser) && normalizedUser.length >= 3) {
    return true;
  }

  const similarity = this.calculateSimilarity(normalizedUser, normalizedCorrect);
  return similarity > 0.8;
}
```

**ê°œì„  íš¨ê³¼**:
1. âœ… ì •ë‹µì´ ì§€ì •ëœ ê³¡: ì •í™•í•œ ì •ë‹µë§Œ ì¸ì •
2. âœ… ì •ë‹µì´ ì—†ëŠ” ê³¡: ê¸°ì¡´ ë°©ì‹ ìœ ì§€ (í•˜ìœ„ í˜¸í™˜)
3. âœ… ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥

**submitAnswer() í˜¸ì¶œ ë³€ê²½**:

```typescript
// Before
const isCorrect = this.checkAnswer(answer, room.gameState.currentTrack.name);

// After
const isCorrect = this.checkAnswer(answer, room.gameState.currentTrack);  // âœ… Track ê°ì²´ ì „ë‹¬
```

---

### 4. YouTubeService ìˆ˜ì •

#### packages/server/src/services/youtube.ts

**getTracks() ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½**:

```typescript
// Before
async getTracks(videoIds: string[]): Promise<Track[]>

// After âœ…
async getTracks(
  videoIds: string[],
  playlistTracks?: PlaylistTrack[]  // âœ… ìƒˆ íŒŒë¼ë¯¸í„°
): Promise<Track[]>
```

**Track ìƒì„± ì‹œ answers ë§¤í•‘**:

```typescript
const tracks: Track[] = apiResponse.items.map((item, index) => {
  // âœ… playlistTracksì—ì„œ videoIdë¡œ ë§¤ì¹­í•˜ì—¬ answers ì¶”ì¶œ
  const playlistTrack = playlistTracks?.find((pt) => pt.videoId === item.id);

  return {
    id: item.id,
    name: item.snippet.title,
    artist: item.snippet.channelTitle,
    uploadDate: item.snippet.publishedAt.split("T")[0],
    year: new Date(item.snippet.publishedAt).getFullYear().toString(),
    embedUrl: `https://www.youtube.com/embed/${item.id}`,
    duration: this.parseDuration(item.contentDetails.duration),
    startSeconds: 0,
    endSeconds: 30,
    thumbnailUrl: item.snippet.thumbnails.high.url,
    answers: playlistTrack?.answers || [],  // âœ… answers ë§¤í•‘
  };
});
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- `playlistTracks`ê°€ ì—†ìœ¼ë©´ ë¹ˆ ë°°ì—´ `[]` ì‚¬ìš© (í•˜ìœ„ í˜¸í™˜)
- videoIdë¡œ ë§¤ì¹­í•˜ì—¬ ì •ë‹µ ì •ë³´ ì •í™•íˆ ë§¤í•‘

---

### 5. Socket í•¸ë“¤ëŸ¬ ìˆ˜ì •

#### packages/server/src/socket/handlers/game.handler.ts

**handleStartGame() ìˆ˜ì •**:

```typescript
// Before
const videoIds = playlist.trackIds;  // âŒ
const tracks = await youtubeService.getTracks(videoIds);

// After âœ…
const videoIds = playlist.tracks.map(t => t.videoId);  // âœ…
const tracks = await youtubeService.getTracks(videoIds, playlist.tracks);  // âœ… playlistTracks ì „ë‹¬
```

**hideTrackInfo() í•¨ìˆ˜**:
- ì´ë¯¸ `answers` í•„ë“œë¥¼ ì œê±°í•˜ê³  ìˆì–´ ì¶”ê°€ ìˆ˜ì • ë¶ˆí•„ìš”
- í´ë¼ì´ì–¸íŠ¸ë¡œ ì •ë‹µì´ ì „ì†¡ë˜ì§€ ì•Šë„ë¡ ë³´ì¥

---

### 6. API ì—”ë“œí¬ì¸íŠ¸ ìˆ˜ì •

#### packages/server/src/index.ts

**POST /api/playlists/:id/tracks**:

```typescript
// Before
const { trackId } = req.body;
if (!trackId || typeof trackId !== "string") {
  return res.status(400).json({ error: "Track ID is required" });
}
const result = await playlistService.addTrack(id, trackId);

// After âœ…
const { videoId, answers } = req.body;
if (!videoId || typeof videoId !== "string") {
  return res.status(400).json({ error: "Video ID is required" });
}
const result = await playlistService.addTrack(id, videoId, answers || []);  // âœ… answers ì „ë‹¬
```

**PUT /api/playlists/:id/tracks/:videoId** (ì‹ ê·œ ì¶”ê°€) âœ…:

```typescript
app.put("/api/playlists/:id/tracks/:videoId", async (req, res) => {
  const { id, videoId } = req.params;
  const { answers } = req.body;

  if (!answers || !Array.isArray(answers)) {
    return res.status(400).json({ error: "Answers array is required" });
  }

  const result = await playlistService.updateTrack(id, videoId, answers);

  if (!result.success) {
    return res.status(400).json({ error: result.error });
  }

  return res.json(result.playlist);
});
```

**DELETE /api/playlists/:id/tracks/:videoId**:

```typescript
// Before: /api/playlists/:id/tracks/:trackId
// After: /api/playlists/:id/tracks/:videoId âœ… (URL íŒŒë¼ë¯¸í„°ëª… ë³€ê²½)
```

---

## Frontend êµ¬í˜„

### 1. íƒ€ì… ì •ì˜

#### PlaylistManager.svelte (ë˜ëŠ” Playlist.svelte)

```typescript
interface PlaylistTrack {
  videoId: string;
  answers: string[];
}

interface Playlist {
  id: string;
  name: string;
  description: string;
  tracks: PlaylistTrack[];  // âœ… trackIds â†’ tracks
  roundCount: number;
}

interface Track {
  id: string;
  name: string;
  artist: string;
  duration: number;
  startSeconds: number;
  endSeconds: number;
}
```

---

### 2. íŠ¸ë™ ì¶”ê°€ UI

#### YouTube URL ìë™ íŒŒì‹±

```typescript
// extractVideoId() í•¨ìˆ˜
function extractVideoId(url: string): string | null {
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/,
    /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
    /youtube\.com\/v\/([a-zA-Z0-9_-]{11})/,
  ];

  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match && match[1]) return match[1];
  }

  // 11ìë¦¬ ë¹„ë””ì˜¤ ID ì§ì ‘ ì…ë ¥
  if (/^[a-zA-Z0-9_-]{11}$/.test(url.trim())) {
    return url.trim();
  }

  return null;
}

// handleUrlInput() í•¨ìˆ˜
async function handleUrlInput() {
  const extractedId = extractVideoId(youtubeUrl);

  if (!extractedId) {
    alert("ìœ íš¨í•œ YouTube URL ë˜ëŠ” ë¹„ë””ì˜¤ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
    return;
  }

  videoId = extractedId;
  await searchTrack();
}
```

**ì§€ì›í•˜ëŠ” URL í˜•ì‹**:
- `https://youtube.com/watch?v=dQw4w9WgXcQ`
- `https://youtu.be/dQw4w9WgXcQ`
- `https://youtube.com/embed/dQw4w9WgXcQ`
- `dQw4w9WgXcQ` (ë¹„ë””ì˜¤ ID ì§ì ‘ ì…ë ¥)

---

#### ë‹¤ì¤‘ ì •ë‹µ ì…ë ¥ UI

```svelte
<!-- ìƒíƒœ ê´€ë¦¬ -->
<script lang="ts">
  let answers = $state<string[]>([""]); // ì •ë‹µ ëª©ë¡ (ìµœì†Œ 1ê°œ)

  // ì •ë‹µ ì¶”ê°€
  function addAnswer() {
    answers = [...answers, ""];
  }

  // ì •ë‹µ ì œê±°
  function removeAnswer(index: number) {
    if (answers.length === 1) {
      answers = [""];  // ë§ˆì§€ë§‰ í•˜ë‚˜ëŠ” ë¹ˆ ë¬¸ìì—´ë¡œ ë³€ê²½
    } else {
      answers = answers.filter((_, i) => i !== index);
    }
  }

  // ì •ë‹µ ì—…ë°ì´íŠ¸
  function updateAnswer(index: number, value: string) {
    answers[index] = value;
  }
</script>

<!-- UI -->
<div class="answers-section">
  <h4>ì •ë‹µ ì…ë ¥</h4>
  <p class="hint">
    ê²Œì„ì—ì„œ ì¸ì •í•  ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”. ë¹„ì›Œë‘ë©´ YouTube ì œëª©ìœ¼ë¡œ ì²´í¬í•©ë‹ˆë‹¤.
  </p>

  <div class="answers-list">
    {#each answers as answer, index}
      <div class="answer-input-row">
        <input
          type="text"
          value={answer}
          oninput={(e) => updateAnswer(index, e.currentTarget.value)}
          placeholder="ì •ë‹µ {index + 1}"
          onkeydown={(e) => e.key === "Enter" && addAnswer()}
        />
        <button
          class="btn-remove"
          onclick={() => removeAnswer(index)}
          title="ì •ë‹µ ì œê±°"
        >
          âœ•
        </button>
      </div>
    {/each}
  </div>

  <button class="btn-add-answer" onclick={addAnswer}>
    â• ì •ë‹µ ì¶”ê°€
  </button>
</div>
```

**ì£¼ìš” ê¸°ëŠ¥**:
- Column í˜•ì‹ ë ˆì´ì•„ì›ƒ (ì„¸ë¡œ ì •ë ¬)
- ì •ë‹µ ì¶”ê°€ ë²„íŠ¼ (Enter í‚¤ ì§€ì›)
- ì •ë‹µ ì œê±° ë²„íŠ¼ (ë§ˆì§€ë§‰ í•˜ë‚˜ëŠ” ë¹ˆ ë¬¸ìì—´ë¡œ)
- íŒíŠ¸ ë©”ì‹œì§€

---

#### íŠ¸ë™ ì¶”ê°€ API í˜¸ì¶œ

```typescript
async function addTrack() {
  if (!selectedPlaylist || !trackInfo) return;

  // ë¹ˆ ë¬¸ìì—´ í•„í„°ë§
  const filteredAnswers = answers.filter((a) => a.trim() !== "");

  try {
    loading = true;
    error = "";

    const response = await fetch(
      `/api/playlists/${selectedPlaylist.id}/tracks`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          videoId: trackInfo.id,  // âœ…
          answers: filteredAnswers,  // âœ…
        }),
      }
    );

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || "Failed to add track");
    }

    const updatedPlaylist = await response.json();
    playlists = playlists.map((p) =>
      p.id === updatedPlaylist.id ? updatedPlaylist : p
    );
    selectedPlaylist = updatedPlaylist;
    tracks = [...tracks, trackInfo];

    // í¼ ì´ˆê¸°í™”
    showTrackForm = false;
    youtubeUrl = "";
    videoId = "";
    trackInfo = null;
    answers = [""];  // âœ… ì´ˆê¸°í™”
  } catch (err: any) {
    error = err.message;
    alert(err.message);
  } finally {
    loading = false;
  }
}
```

---

### 3. íŠ¸ë™ ì •ë‹µ ìˆ˜ì • UI

#### ìƒíƒœ ê´€ë¦¬

```typescript
// ìˆ˜ì • ëª¨ë“œ ìƒíƒœ
let editingTrackId = $state<string | null>(null);
let editAnswers = $state<string[]>([]);

// ìˆ˜ì • ì‹œì‘
function startEditTrack(videoId: string) {
  if (!selectedPlaylist) return;

  const track = selectedPlaylist.tracks.find((t) => t.videoId === videoId);
  if (!track) return;

  editingTrackId = videoId;
  editAnswers = track.answers.length > 0 ? [...track.answers] : [""];
}

// ìˆ˜ì • ì·¨ì†Œ
function cancelEditTrack() {
  editingTrackId = null;
  editAnswers = [];
}

// ì •ë‹µ ì €ì¥
async function updateTrackAnswers(videoId: string) {
  if (!selectedPlaylist) return;

  const filteredAnswers = editAnswers.filter((a) => a.trim() !== "");

  try {
    loading = true;
    error = "";

    const response = await fetch(
      `/api/playlists/${selectedPlaylist.id}/tracks/${videoId}`,
      {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ answers: filteredAnswers }),
      }
    );

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || "Failed to update track");
    }

    const updatedPlaylist = await response.json();
    playlists = playlists.map((p) =>
      p.id === updatedPlaylist.id ? updatedPlaylist : p
    );
    selectedPlaylist = updatedPlaylist;

    cancelEditTrack();
    alert("ì •ë‹µì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!");
  } catch (err: any) {
    error = err.message;
    alert(err.message);
  } finally {
    loading = false;
  }
}
```

---

#### UI êµ¬í˜„

```svelte
<!-- íŠ¸ë™ ëª©ë¡ -->
{#each tracks as track}
  {@const answers = getTrackAnswers(track.id)}
  <div class="track-item-container">
    <div class="track-item">
      <div class="track-info">
        <div class="track-name">{track.name}</div>
        <div class="track-artist">{track.artist}</div>
        <div class="track-answers">
          <strong>ì •ë‹µ:</strong>
          {#if answers.length > 0 && answers.some((a) => a.trim())}
            {answers.filter((a) => a.trim()).join(", ")}
          {:else}
            <span class="no-answers">(YouTube ì œëª©)</span>
          {/if}
        </div>
      </div>
      <div class="track-actions">
        <button
          class="btn-edit"
          onclick={() => startEditTrack(track.id)}
          title="ì •ë‹µ ìˆ˜ì •"
        >
          âœï¸ ìˆ˜ì •
        </button>
        <button
          class="btn-delete"
          onclick={() => removeTrack(track.id)}
          title="íŠ¸ë™ ì œê±°"
        >
          ğŸ—‘ï¸ ì‚­ì œ
        </button>
      </div>
    </div>

    <!-- ìˆ˜ì • í¼ (editingTrackId === track.idì¼ ë•Œë§Œ í‘œì‹œ) -->
    {#if editingTrackId === track.id}
      <div class="track-edit-form">
        <h4>ì •ë‹µ ìˆ˜ì •</h4>
        <div class="answers-list">
          {#each editAnswers as answer, index}
            <div class="answer-input-row">
              <input
                type="text"
                value={answer}
                oninput={(e) =>
                  updateEditAnswer(index, e.currentTarget.value)}
                placeholder="ì •ë‹µ {index + 1}"
              />
              <button
                class="btn-remove"
                onclick={() => removeEditAnswer(index)}
                title="ì •ë‹µ ì œê±°"
              >
                âœ•
              </button>
            </div>
          {/each}
        </div>
        <button class="btn-add-answer" onclick={addEditAnswer}>
          â• ì •ë‹µ ì¶”ê°€
        </button>
        <div class="track-edit-actions">
          <button
            class="btn-save"
            onclick={() => updateTrackAnswers(track.id)}
          >
            âœ… ì €ì¥
          </button>
          <button class="btn-cancel" onclick={cancelEditTrack}>
            âŒ ì·¨ì†Œ
          </button>
        </div>
      </div>
    {/if}
  </div>
{/each}
```

**ì£¼ìš” ê¸°ëŠ¥**:
- ê° íŠ¸ë™ì— âœï¸ ìˆ˜ì • ë²„íŠ¼
- ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ì •ë‹µ ì…ë ¥ í¼ í¼ì¹˜ê¸°
- ê¸°ì¡´ ì •ë‹µ ìë™ ë¡œë“œ
- âœ… ì €ì¥ / âŒ ì·¨ì†Œ ë²„íŠ¼

---

## ì •ë‹µ ì²´í¬ ë¡œì§ ê°œì„ 

### ë³€ê²½ ì „í›„ ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Before                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ì‚¬ìš©ì ì…ë ¥: "PSY"                                             â”‚
â”‚  ì •ë‹µ: "ê°•ë‚¨ìŠ¤íƒ€ì¼"                                              â”‚
â”‚                                                                 â”‚
â”‚  ë¹„êµ: "psy" vs "ê°•ë‚¨ìŠ¤íƒ€ì¼"                                     â”‚
â”‚  ê²°ê³¼: âŒ í‹€ë¦¼ (ìœ ì‚¬ë„ ë„ˆë¬´ ë‚®ìŒ)                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        After                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ì‚¬ìš©ì ì…ë ¥: "PSY"                                             â”‚
â”‚  ì •ë‹µ ë°°ì—´: ["ê°•ë‚¨ìŠ¤íƒ€ì¼", "Gangnam Style", "PSY"]              â”‚
â”‚                                                                 â”‚
â”‚  ë¹„êµ 1: "psy" vs "ê°•ë‚¨ìŠ¤íƒ€ì¼" â†’ âŒ                             â”‚
â”‚  ë¹„êµ 2: "psy" vs "gangnamstyle" â†’ âŒ                           â”‚
â”‚  ë¹„êµ 3: "psy" vs "psy" â†’ âœ… ì •ë‹µ!                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•˜ìœ„ í˜¸í™˜ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         answers ë°°ì—´ì´ ë¹„ì–´ìˆëŠ” ê²½ìš° (í•˜ìœ„ í˜¸í™˜)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Track {                                                        â”‚
â”‚    name: "Dynamite",                                            â”‚
â”‚    answers: []  â† ë¹ˆ ë°°ì—´                                       â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â”‚  â†’ ê¸°ì¡´ ë°©ì‹ ì‚¬ìš© (track.nameê³¼ ë¹„êµ)                          â”‚
â”‚  â†’ ìœ ì‚¬ë„ ì²´í¬ (80% ì´ìƒ)                                       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì •ë‹µ ì²´í¬ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

```typescript
checkAnswer(answer: string, track: Track): boolean {
  const normalizedUser = this.normalize(answer);

  // 1ë‹¨ê³„: answers ë°°ì—´ í™•ì¸
  if (track.answers && track.answers.length > 0) {
    for (const correctAnswer of track.answers) {
      const normalizedCorrect = this.normalize(correctAnswer);

      // 2ë‹¨ê³„: ì™„ì „ ì¼ì¹˜ ì²´í¬
      if (normalizedUser === normalizedCorrect) return true;

      // 3ë‹¨ê³„: ë¶€ë¶„ ì¼ì¹˜ ì²´í¬ (3ì ì´ìƒ)
      if (normalizedCorrect.includes(normalizedUser) && normalizedUser.length >= 3) {
        return true;
      }

      // 4ë‹¨ê³„: ìœ ì‚¬ë„ ì²´í¬ (80% ì´ìƒ)
      const similarity = this.calculateSimilarity(normalizedUser, normalizedCorrect);
      if (similarity > 0.8) return true;
    }

    // ëª¨ë“  ì •ë‹µê³¼ ë§¤ì¹˜ ì•ˆë¨
    return false;
  }

  // 5ë‹¨ê³„: answersê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë°©ì‹ (track.name)
  const normalizedCorrect = this.normalize(track.name);
  if (normalizedUser === normalizedCorrect) return true;
  if (normalizedCorrect.includes(normalizedUser) && normalizedUser.length >= 3) {
    return true;
  }
  const similarity = this.calculateSimilarity(normalizedUser, normalizedCorrect);
  return similarity > 0.8;
}

// ì •ê·œí™” í•¨ìˆ˜
private normalize(str: string): string {
  return str
    .toLowerCase()
    .replace(/[\s\-_.()[\]{}!?,;:'"]/g, "")
    .trim();
}

// ìœ ì‚¬ë„ ê³„ì‚° (Levenshtein distance ê¸°ë°˜)
private calculateSimilarity(str1: string, str2: string): number {
  const longer = str1.length > str2.length ? str1 : str2;
  const shorter = str1.length > str2.length ? str2 : str1;

  if (longer.length === 0) return 1.0;

  const editDistance = this.levenshteinDistance(longer, shorter);
  return (longer.length - editDistance) / longer.length;
}
```

---

## API ëª…ì„¸

### í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ íŠ¸ë™ ê´€ë¦¬

| Method | Endpoint | Request Body | Response | ì„¤ëª… |
|--------|----------|--------------|----------|------|
| POST | `/api/playlists/:id/tracks` | `{ videoId, answers }` | `Playlist` | íŠ¸ë™ ì¶”ê°€ (ì •ë‹µ í¬í•¨) |
| PUT | `/api/playlists/:id/tracks/:videoId` | `{ answers }` | `Playlist` | íŠ¸ë™ ì •ë‹µ ìˆ˜ì • |
| DELETE | `/api/playlists/:id/tracks/:videoId` | - | `Playlist` | íŠ¸ë™ ì œê±° |

### Request ìƒì„¸

#### POST /api/playlists/:id/tracks

```json
{
  "videoId": "dQw4w9WgXcQ",
  "answers": [
    "Never Gonna Give You Up",
    "Rick Astley",
    "ë¦­ ì• ìŠ¬ë¦¬"
  ]
}
```

#### PUT /api/playlists/:id/tracks/:videoId

```json
{
  "answers": [
    "Gangnam Style",
    "ê°•ë‚¨ìŠ¤íƒ€ì¼",
    "PSY",
    "ì‹¸ì´"
  ]
}
```

### Response ì˜ˆì‹œ

```json
{
  "id": "test-playlist",
  "name": "í…ŒìŠ¤íŠ¸ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸",
  "description": "ë‹¤ì¤‘ ì •ë‹µ í…ŒìŠ¤íŠ¸ìš©",
  "tracks": [
    {
      "videoId": "dQw4w9WgXcQ",
      "answers": [
        "Never Gonna Give You Up",
        "Rick Astley",
        "ë¦­ ì• ìŠ¬ë¦¬"
      ]
    }
  ],
  "roundCount": 1
}
```

---

## ë°ì´í„° ëª¨ë¸

### PlaylistTrack

```typescript
interface PlaylistTrack {
  videoId: string;      // YouTube ë¹„ë””ì˜¤ ID (11ìë¦¬)
  answers: string[];    // ì •ë‹µ ëª©ë¡ (ë¹ˆ ë°°ì—´ ê°€ëŠ¥)
}
```

**ì˜ˆì‹œ**:
```json
{
  "videoId": "9bZkp7q19f0",
  "answers": [
    "Gangnam Style",
    "ê°•ë‚¨ìŠ¤íƒ€ì¼",
    "PSY",
    "ì‹¸ì´"
  ]
}
```

### Playlist

```typescript
interface Playlist {
  id: string;
  name: string;
  description: string;
  tracks: PlaylistTrack[];  // â† trackIdsì—ì„œ ë³€ê²½
  roundCount: number;
}
```

### Track

```typescript
interface Track {
  id: string;              // YouTube ë¹„ë””ì˜¤ ID
  name: string;            // ê³¡ ì œëª©
  artist: string;          // ì•„í‹°ìŠ¤íŠ¸
  duration: number;        // ì´ ê¸¸ì´ (ì´ˆ)
  startSeconds: number;    // ì¬ìƒ ì‹œì‘ ì‹œê°„
  endSeconds: number;      // ì¬ìƒ ì¢…ë£Œ ì‹œê°„
  answers: string[];       // â† ìƒˆë¡œ ì¶”ê°€ëœ í•„ë“œ
}
```

### playlists.json ì €ì¥ í˜•ì‹

```json
{
  "test-playlist": {
    "id": "test-playlist",
    "name": "í…ŒìŠ¤íŠ¸ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸",
    "description": "ë‹¤ì¤‘ ì •ë‹µ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸",
    "tracks": [
      {
        "videoId": "dQw4w9WgXcQ",
        "answers": [
          "Never Gonna Give You Up",
          "Rick Astley",
          "ë¦­ ì• ìŠ¬ë¦¬"
        ]
      },
      {
        "videoId": "9bZkp7q19f0",
        "answers": [
          "Gangnam Style",
          "ê°•ë‚¨ìŠ¤íƒ€ì¼",
          "PSY",
          "ì‹¸ì´"
        ]
      }
    ],
    "roundCount": 2
  }
}
```

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: í´ë¼ì´ì–¸íŠ¸ íƒ€ì… ì˜¤ë¥˜

**ì¦ìƒ**:
```
Uncaught TypeError: Cannot read properties of undefined (reading 'length')
at App.svelte:554:78
```

**ì›ì¸**:
- ì„œë²„: `tracks: PlaylistTrack[]` êµ¬ì¡°ë¡œ ë³€ê²½ ì™„ë£Œ
- í´ë¼ì´ì–¸íŠ¸: ì—¬ì „íˆ `trackIds` ì‚¬ìš©
- `playlist.trackIds`ê°€ `undefined`ì—¬ì„œ ì˜¤ë¥˜ ë°œìƒ

**í•´ê²°**:
```typescript
// App.svelte
// Before
{playlist.trackIds.length} íŠ¸ë™

// After
{playlist.tracks?.length || 0} íŠ¸ë™
```

```typescript
// PlaylistManager.svelte
// Before
interface Playlist {
  trackIds: string[];
}

// After
interface Playlist {
  tracks: PlaylistTrack[];
}
```

---

### ë¬¸ì œ 2: API íŒŒë¼ë¯¸í„° ë¶ˆì¼ì¹˜

**ì¦ìƒ**:
```
POST /api/playlists/:id/tracks 400 (Bad Request)
Error: Track ID is required
```

**ì›ì¸**:
- í´ë¼ì´ì–¸íŠ¸: `{ videoId, answers }` ì „ì†¡
- ì„œë²„: `{ trackId }` ë°›ë„ë¡ ë˜ì–´ ìˆìŒ

**í•´ê²°**:
```typescript
// index.ts
// Before
const { trackId } = req.body;
const result = await playlistService.addTrack(id, trackId);

// After
const { videoId, answers } = req.body;
const result = await playlistService.addTrack(id, videoId, answers || []);
```

---

### ë¬¸ì œ 3: ë¹ˆ ì •ë‹µ ë°°ì—´ ì²˜ë¦¬

**ë¬¸ì œ**: ì‚¬ìš©ìê°€ ì •ë‹µì„ ì…ë ¥í•˜ì§€ ì•Šê³  ë¹ˆ ë¬¸ìì—´ë§Œ ë‚¨ê¸´ ê²½ìš°

**í•´ê²°**:
```typescript
// ë¹ˆ ë¬¸ìì—´ í•„í„°ë§
const filteredAnswers = answers.filter((a) => a.trim() !== "");

// API í˜¸ì¶œ
body: JSON.stringify({
  videoId: trackInfo.id,
  answers: filteredAnswers,  // ë¹ˆ ë°°ì—´ì´ë©´ []
})
```

**GameServiceì—ì„œ ì²˜ë¦¬**:
```typescript
// answersê°€ ë¹ˆ ë°°ì—´ì´ë©´ ê¸°ì¡´ ë°©ì‹(track.name) ì‚¬ìš©
if (track.answers && track.answers.length > 0) {
  // answers ë°°ì—´ ì²´í¬
} else {
  // track.name ì²´í¬ (í•˜ìœ„ í˜¸í™˜)
}
```

---

## í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

| ê¸°ëŠ¥ | í…ŒìŠ¤íŠ¸ í•­ëª© | ê²°ê³¼ | ë¹„ê³  |
|------|-------------|------|------|
| íŠ¸ë™ ì¶”ê°€ | YouTube URL íŒŒì‹± | âœ… ì„±ê³µ | 5ê°€ì§€ í˜•ì‹ ëª¨ë‘ ì§€ì› |
| íŠ¸ë™ ì¶”ê°€ | ë‹¤ì¤‘ ì •ë‹µ ì…ë ¥ | âœ… ì„±ê³µ | 3ê°œ ì •ë‹µ ì¶”ê°€ í™•ì¸ |
| íŠ¸ë™ ì¶”ê°€ | ë¹ˆ ì •ë‹µ í•„í„°ë§ | âœ… ì„±ê³µ | ë¹ˆ ë¬¸ìì—´ ì œê±°ë¨ |
| íŠ¸ë™ ìˆ˜ì • | ê¸°ì¡´ ì •ë‹µ ë¡œë“œ | âœ… ì„±ê³µ | ì •ë‹µ ìë™ ë¡œë“œ |
| íŠ¸ë™ ìˆ˜ì • | ì •ë‹µ ì¶”ê°€/ì œê±° | âœ… ì„±ê³µ | ë™ì ìœ¼ë¡œ ì¶”ê°€/ì œê±° |
| íŠ¸ë™ ìˆ˜ì • | ì •ë‹µ ì €ì¥ | âœ… ì„±ê³µ | JSON íŒŒì¼ ì—…ë°ì´íŠ¸ |
| ì •ë‹µ ì²´í¬ | answers ë°°ì—´ ë¹„êµ | âœ… ì„±ê³µ | 3ê°œ ì¤‘ 1ê°œ ë§¤ì¹˜ |
| ì •ë‹µ ì²´í¬ | í•˜ìœ„ í˜¸í™˜ (ë¹ˆ ë°°ì—´) | âœ… ì„±ê³µ | track.name ì‚¬ìš© |
| ê²Œì„ ì§„í–‰ | answers í¬í•¨ Track | âœ… ì„±ê³µ | YouTubeService ë§¤í•‘ |

### ì •ë‹µ ì²´í¬ í…ŒìŠ¤íŠ¸

| íŠ¸ë™ | ì •ë‹µ ë°°ì—´ | ì‚¬ìš©ì ì…ë ¥ | ê²°ê³¼ | ë¹„ê³  |
|------|-----------|-------------|------|------|
| Gangnam Style | ["ê°•ë‚¨ìŠ¤íƒ€ì¼", "PSY"] | "PSY" | âœ… ì •ë‹µ | ì™„ì „ ì¼ì¹˜ |
| Gangnam Style | ["ê°•ë‚¨ìŠ¤íƒ€ì¼", "PSY"] | "ì‹¸ì´" | âœ… ì •ë‹µ | ìœ ì‚¬ë„ 80% |
| Gangnam Style | ["ê°•ë‚¨ìŠ¤íƒ€ì¼", "PSY"] | "ê°•ë‚¨" | âœ… ì •ë‹µ | ë¶€ë¶„ ì¼ì¹˜ (3ì) |
| Gangnam Style | ["ê°•ë‚¨ìŠ¤íƒ€ì¼", "PSY"] | "BTS" | âŒ ì˜¤ë‹µ | ë§¤ì¹˜ ì•ˆë¨ |
| Dynamite | [] | "Dynamite" | âœ… ì •ë‹µ | track.name ì‚¬ìš© |

### ë¹Œë“œ í…ŒìŠ¤íŠ¸

```bash
# ì„œë²„ ë¹Œë“œ
cd packages/server
npm run build
# âœ… ì„±ê³µ (íƒ€ì… ì˜¤ë¥˜ ì—†ìŒ)

# í´ë¼ì´ì–¸íŠ¸ ë¹Œë“œ
cd packages/client
npm run build
# âœ… ì„±ê³µ (107.05 kB gzip)
# âš ï¸ ì ‘ê·¼ì„± ê²½ê³  (ê¸°ëŠ¥ì— ì˜í–¥ ì—†ìŒ)
```

---

## í–¥í›„ ê°œì„  ì‚¬í•­

### ë‹¨ê¸° ê°œì„  (1-2ì£¼)

1. **ì •ë‹µ ë³„ì¹­ ìë™ ìƒì„±**
   ```typescript
   // YouTube APIì—ì„œ ê°€ì ¸ì˜¨ ì œëª©ì„ ìë™ìœ¼ë¡œ ì •ë‹µì— ì¶”ê°€
   const autoAnswers = [
     track.name,         // YouTube ì œëª©
     track.artist,       // ì•„í‹°ìŠ¤íŠ¸ëª…
     ...track.answers,   // ìˆ˜ë™ ì¶”ê°€ ì •ë‹µ
   ];
   ```

2. **ì •ë‹µ ê²€ì¦ API**
   ```typescript
   // POST /api/playlists/:id/validate
   // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ì˜ ëª¨ë“  ì •ë‹µì´ ìœ íš¨í•œì§€ ì²´í¬
   {
     "valid": false,
     "issues": [
       {
         "trackId": "abc123",
         "issue": "No answers provided"
       }
     ]
   }
   ```

3. **ëŒ€ëŸ‰ ì •ë‹µ ì¶”ê°€**
   - CSV íŒŒì¼ ì—…ë¡œë“œë¡œ í•œë²ˆì— ì—¬ëŸ¬ íŠ¸ë™ ì •ë‹µ ì„¤ì •
   - í˜•ì‹: `videoId,answer1,answer2,answer3`

### ì¤‘ê¸° ê°œì„  (1-2ê°œì›”)

1. **ì •ë‹µ ë‚œì´ë„ ì‹œìŠ¤í…œ**
   ```typescript
   interface PlaylistTrack {
     videoId: string;
     answers: {
       text: string;
       difficulty: "easy" | "medium" | "hard";
     }[];
   }

   // "PSY" â†’ easy (50ì )
   // "ê°•ë‚¨ìŠ¤íƒ€ì¼" â†’ medium (100ì )
   // "Gangnam Style" â†’ hard (150ì )
   ```

2. **AI ê¸°ë°˜ ì •ë‹µ ì¶”ì²œ**
   - YouTube ì œëª© ë¶„ì„í•˜ì—¬ ì •ë‹µ í›„ë³´ ìë™ ì œì•ˆ
   - ì•„í‹°ìŠ¤íŠ¸ëª…, ê³¡ëª… íŒŒì‹±
   - ë‹¤êµ­ì–´ ë³€í™˜ (í•œê¸€ â†” ì˜ì–´)

3. **ì •ë‹µ í†µê³„ ë° ë¶„ì„**
   - ê° ì •ë‹µì´ ì–¼ë§ˆë‚˜ ìì£¼ ì‚¬ìš©ë˜ëŠ”ì§€ ì¶”ì 
   - ì¸ê¸° ì •ë‹µ / ì˜ ì•ˆì“°ëŠ” ì •ë‹µ ë¶„ì„
   - ì •ë‹µ ì¶”ì²œ ê°œì„ 

### ì¥ê¸° ê°œì„  (3-6ê°œì›”)

1. **ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ ì •ë‹µ ì²´í¬**
   - ìœ ì‚¬ë„ ì•Œê³ ë¦¬ì¦˜ ê°œì„ 
   - ìŒì„± ì¸ì‹ í†µí•© (ìŒì„±ìœ¼ë¡œ ì •ë‹µ ì…ë ¥)
   - ì˜¤íƒ€ ìë™ êµì •

2. **ì»¤ë®¤ë‹ˆí‹° ê¸°ì—¬ ì‹œìŠ¤í…œ**
   - ì‚¬ìš©ìë“¤ì´ ì •ë‹µ ì œì•ˆ
   - íˆ¬í‘œ ì‹œìŠ¤í…œìœ¼ë¡œ ê²€ì¦
   - ì •ë‹µ í’ˆì§ˆ ê´€ë¦¬

3. **ë‹¤êµ­ì–´ ì •ë‹µ ì§€ì› ê°•í™”**
   - ìë™ ë²ˆì—­ API í†µí•©
   - ì§€ì—­ë³„ ì •ë‹µ ë³€í˜• ì§€ì›
   - ë°œìŒ ê¸°ë°˜ ë§¤ì¹­

---

## ê²°ë¡ 

### êµ¬í˜„ ì„±ê³¼

- âœ… íŠ¸ë™ë³„ ë‹¤ì¤‘ ì •ë‹µ ì‹œìŠ¤í…œ ì™„ì „ êµ¬í˜„
- âœ… YouTube URL ìë™ íŒŒì‹± ê¸°ëŠ¥
- âœ… ì •ë‹µ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ UI êµ¬í˜„
- âœ… í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€ (answers ë¹ˆ ë°°ì—´)
- âœ… ì •ë‹µ ì²´í¬ ë¡œì§ ê°œì„  (ì •í™•ë„ í–¥ìƒ)
- âœ… ì „ì²´ ë¹Œë“œ ì„±ê³µ (íƒ€ì… ì•ˆì •ì„± í™•ë³´)

### ê¸°ìˆ ì  ì„±ê³¼

- TypeScriptë¥¼ í™œìš©í•œ íƒ€ì… ì•ˆì „ì„± í™•ë³´
- ë°ì´í„° êµ¬ì¡° ì²´ê³„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ (`trackIds` â†’ `tracks`)
- RESTful API ì„¤ê³„ ì›ì¹™ ì ìš©
- ì ì§„ì  ì—…ê·¸ë ˆì´ë“œ ì „ëµ (í•˜ìœ„ í˜¸í™˜ì„±)
- Svelte 5 Runes API í™œìš©í•œ ë°˜ì‘í˜• UI

### ê°œì„  íš¨ê³¼

**Before**:
```
íŠ¸ë™: "Rick Astley - Never Gonna Give You Up (Official Music Video)"
ì‚¬ìš©ì ì…ë ¥: "Rick Astley" â†’ âŒ í‹€ë¦¼ (ìœ ì‚¬ë„ ë‚®ìŒ)
```

**After**:
```
íŠ¸ë™ ì •ë‹µ: ["Never Gonna Give You Up", "Rick Astley", "ë¦­ ì• ìŠ¬ë¦¬"]
ì‚¬ìš©ì ì…ë ¥: "Rick Astley" â†’ âœ… ì •ë‹µ!
```

### ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

1. **ì •í™•ë„ í–¥ìƒ**: ë‹¤ì–‘í•œ ì •ë‹µ í˜•íƒœ ì¸ì •
2. **ë‹¤êµ­ì–´ ì§€ì›**: í•œê¸€/ì˜ì–´ ì •ë‹µ ë™ì‹œ ì§€ì›
3. **í¸ì˜ì„±**: YouTube URLë§Œ ì…ë ¥í•˜ë©´ ìë™ íŒŒì‹±
4. **ìœ ì—°ì„±**: ì •ë‹µ ìˆ˜ì • ê¸°ëŠ¥ìœ¼ë¡œ ì§€ì†ì  ê°œì„  ê°€ëŠ¥

---

## ì°¸ê³  ìë£Œ

### ì½”ë“œ ìœ„ì¹˜

**Backend**:
- `packages/server/src/types/index.ts` - íƒ€ì… ì •ì˜
- `packages/server/src/services/playlist.ts` - PlaylistService
- `packages/server/src/services/game.ts` - GameService (ì •ë‹µ ì²´í¬)
- `packages/server/src/services/youtube.ts` - YouTubeService
- `packages/server/src/socket/handlers/game.handler.ts` - Socket í•¸ë“¤ëŸ¬
- `packages/server/src/index.ts` - REST API ì—”ë“œí¬ì¸íŠ¸
- `packages/server/src/data/playlists.json` - í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë°ì´í„°

**Frontend**:
- `packages/client/src/lib/pages/playlist/Playlist.svelte` - í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ í˜ì´ì§€
- `packages/client/src/lib/pages/playlist/PlaylistForm.svelte` - í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í¼
- `packages/client/src/lib/pages/playlist/TrackForm.svelte` - íŠ¸ë™ ì¶”ê°€ í¼
- `packages/client/src/lib/pages/playlist/TrackList.svelte` - íŠ¸ë™ ëª©ë¡

### ê´€ë ¨ ë¬¸ì„œ

- [í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„ ë³´ê³ ì„œ](./í”Œë ˆì´ë¦¬ìŠ¤íŠ¸%20ê´€ë¦¬%20ì‹œìŠ¤í…œ%20êµ¬í˜„%20ë³´ê³ ì„œ.md)
- [ê²Œì„ ì‹œìŠ¤í…œ êµ¬í˜„ ë³´ê³ ì„œ](./ê²Œì„%20ì‹œìŠ¤í…œ%20êµ¬í˜„%20ë³´ê³ ì„œ.md)
- [YouTube API ì—°ë™ êµ¬í˜„ ë³´ê³ ì„œ](./YouTube%20API%20ì—°ë™%20êµ¬í˜„%20ë³´ê³ ì„œ.md)

### ì™¸ë¶€ ì°¸ì¡°

- [YouTube Data API v3](https://developers.google.com/youtube/v3)
- [Levenshtein Distance Algorithm](https://en.wikipedia.org/wiki/Levenshtein_distance)
- [Svelte 5 Documentation](https://svelte-5-preview.vercel.app/)

---

**ì‘ì„±ì¼**: 2025-11-13
**ì‘ì„±ì**: ListenUp! Team
**ë²„ì „**: 1.0.0
