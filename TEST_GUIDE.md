# 🧪 Socket.IO 통신 테스트 가이드

## 준비사항

서버와 클라이언트가 모두 빌드되어 있어야 합니다.

```bash
# 루트 디렉토리에서
npm run build
```

## 실행 방법

### 1. 서버 실행 (터미널 1)

```bash
# 루트 디렉토리에서
npm run dev:server
```

서버가 정상적으로 실행되면 다음과 같은 메시지가 표시됩니다:
```
Server running on http://localhost:3000
Socket.IO Ready
```

### 2. 클라이언트 실행 (터미널 2)

새 터미널을 열고:

```bash
# 루트 디렉토리에서
npm run dev:client
```

브라우저가 자동으로 열리지 않으면 `http://localhost:5173` 접속

## 테스트 시나리오

### ✅ 연결 테스트

1. 클라이언트 페이지를 열면 자동으로 서버에 연결됩니다
2. 상태바가 **초록색**으로 변하고 "✅ 서버 연결 성공!"이 표시되어야 합니다
3. 콘솔에 소켓 ID가 출력됩니다

### ✅ 방 생성 테스트

1. **닉네임** 입력 (예: "플레이어1")
2. **"🏠 새 방 만들기"** 버튼 클릭
3. 방 코드가 생성되고 방 정보가 표시됩니다
4. 참가자 목록에 본인이 표시되며 **👑 방장 표시**가 있어야 합니다

**예상 결과:**
```
방 코드: A1B2C3
방장: 플레이어1
플레이어: 1 / 8명
```

### ✅ 방 참가 테스트 (멀티플레이어)

**두 번째 브라우저 창/시크릿 모드 열기:**

1. `http://localhost:5173` 접속
2. 다른 **닉네임** 입력 (예: "플레이어2")
3. 첫 번째 창에서 생성한 **방 코드** 입력
4. **"🚪 방 참가하기"** 버튼 클릭

**예상 결과:**
- 두 번째 창: "✅ 방 참가 완료!"
- 첫 번째 창: "🎮 플레이어2님이 입장했습니다!" 알림
- 양쪽 모두 참가자 목록에 2명 표시

### ✅ 실시간 동기화 테스트

- 한쪽에서 방을 나가면 다른 쪽에 즉시 반영됩니다
- 방장이 나가면 자동으로 다음 플레이어가 방장이 됩니다 (👑)
- 모든 플레이어가 나가면 방이 자동으로 삭제됩니다

### ✅ 에러 처리 테스트

**중복 닉네임:**
1. 같은 방에 같은 닉네임으로 참가 시도
2. "❌ 방 참가 실패: 이미 사용 중인 닉네임입니다" 표시

**존재하지 않는 방:**
1. 잘못된 방 코드 입력 (예: "XXXXXX")
2. "❌ 방 참가 실패: 방을 찾을 수 없습니다" 표시

**방이 가득 찬 경우:**
1. maxPlayers(기본 8명)를 초과하여 참가 시도
2. "❌ 방 참가 실패: 방이 가득 찼습니다" 표시

## 디버깅

### 브라우저 개발자 도구 (F12)

**Console 탭에서 확인:**
```javascript
서버 연결: <socket-id>
방 생성 성공: { code: "ABC123", players: [...], ... }
새 플레이어 참가: { player: {...}, playerCount: 2 }
```

**Network 탭에서 확인:**
- WebSocket 연결 상태
- Socket.IO 폴링/웹소켓 업그레이드

### 서버 로그 확인

터미널 1 (서버)에서 다음과 같은 로그가 출력됩니다:

```
✅ Client connected: <socket-id>
✅ Room created: ABC123 by 플레이어1
✅ Player 플레이어2 joined room ABC123
✅ Player left room ABC123
🗑️  Room ABC123 deleted (empty)
❌ Client disconnected: <socket-id>
```

## 문제 해결

### 서버 연결 실패

**증상:** "❌ 연결 실패: ..." 표시

**해결:**
1. 서버가 실행 중인지 확인 (`npm run dev:server`)
2. 포트 3000이 사용 중인지 확인
3. `packages/client/src/lib/socket.ts`에서 서버 URL 확인
   ```typescript
   socket = io("http://localhost:3000", { ... });
   ```

### CORS 에러

**증상:** 브라우저 콘솔에 CORS 관련 에러

**해결:**
`packages/server/src/index.ts`에서 CORS 설정 확인:
```typescript
const io = new Server(httpServer, {
  cors: {
    origin: "http://localhost:5173",  // 클라이언트 URL
    methods: ["GET", "POST"],
  },
});
```

### 모듈 해상도 에러

**증상:** TypeScript 빌드 실패

**해결:**
```bash
# tsconfig 확인 후 다시 빌드
npm run build
```

## 성공 체크리스트

- [ ] 서버가 포트 3000에서 실행됨
- [ ] 클라이언트가 포트 5173에서 실행됨
- [ ] 클라이언트가 서버에 자동 연결됨
- [ ] 방 생성이 정상 작동함
- [ ] 방 코드로 참가가 가능함
- [ ] 플레이어 목록이 실시간 업데이트됨
- [ ] 방장 자동 위임이 작동함
- [ ] 방 나가기 기능이 작동함
- [ ] 에러 메시지가 적절히 표시됨
- [ ] 브라우저 콘솔에 에러가 없음

## 다음 단계

테스트가 성공하면:
1. 게임 로직 구현 (트랙 재생, 정답 제출)
2. 채팅 기능 추가
3. UI/UX 개선
4. 데이터베이스 연동 (Redis/PostgreSQL)

---

**문제가 발생하면:**
- 브라우저 콘솔 로그 확인
- 서버 터미널 로그 확인
- 네트워크 탭에서 WebSocket 연결 상태 확인
